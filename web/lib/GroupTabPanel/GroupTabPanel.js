Ext.namespace("lib.GroupTabPanel");Ext.ux.GroupTabPanel=Ext.extend(Ext.TabPanel,{tabPosition:"left",alternateColor:false,alternateCls:"x-grouptabs-panel-alt",defaultType:"grouptab",deferredRender:false,activeGroup:null,initComponent:function(){Ext.ux.GroupTabPanel.superclass.initComponent.call(this);this.addEvents("beforegroupchange","groupchange");this.elements="body,header";this.stripTarget="header";this.tabPosition=this.tabPosition=="right"?"right":"left";this.addClass("x-grouptabs-panel");if(this.tabStyle&&this.tabStyle!=""){this.addClass("x-grouptabs-panel-"+this.tabStyle);}if(this.alternateColor){this.addClass(this.alternateCls);}this.on("beforeadd",function(B,C,A){this.initGroup(C,A);});},initEvents:function(){this.mon(this.strip,"mousedown",this.onStripMouseDown,this);},onRender:function(C,A){Ext.TabPanel.superclass.onRender.call(this,C,A);if(this.plain){var F=this.tabPosition=="top"?"header":"footer";this[F].addClass("x-tab-panel-"+F+"-plain");}var B=this[this.stripTarget];this.stripWrap=B.createChild({cls:"x-tab-strip-wrap ",cn:{tag:"ul",cls:"x-grouptabs-strip x-grouptabs-tab-strip-"+this.tabPosition}});var E=(this.tabPosition=="bottom"?this.stripWrap:null);this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.header.addClass("x-grouptabs-panel-header");this.bwrap.addClass("x-grouptabs-bwrap");this.body.addClass("x-tab-panel-body-"+this.tabPosition+" x-grouptabs-panel-body");if(!this.groupTpl){var D=new Ext.Template('<li class="{cls}" id="{id}">','<a class="x-grouptabs-expand" onclick="return false;"></a>','<a class="x-grouptabs-text {iconCls}" href="#" onclick="return false;">',"<span>{text}</span></a>","</li>");D.disableFormats=true;D.compile();Ext.ux.GroupTabPanel.prototype.groupTpl=D;}this.items.each(this.initGroup,this);},afterRender:function(){Ext.ux.GroupTabPanel.superclass.afterRender.call(this);this.tabJoint=Ext.fly(this.body.dom.parentNode).createChild({cls:"x-tab-joint"});this.addClass("x-tab-panel-"+this.tabPosition);this.header.setWidth(this.tabWidth);if(this.activeGroup!==undefined){var A=(typeof this.activeGroup=="object")?this.activeGroup:this.items.get(this.activeGroup);delete this.activeGroup;this.setActiveGroup(A);A.setActiveTab(A.getMainItem());}},getGroupEl:Ext.TabPanel.prototype.getTabEl,findTargets:function(C){var B=null,A=C.getTarget("li",this.strip);if(A){B=this.findById(A.id.split(this.idDelimiter)[1]);if(B.disabled){return{expand:null,item:null,el:null};}}return{expand:C.getTarget(".x-grouptabs-expand",this.strip),isGroup:!C.getTarget("ul.x-grouptabs-sub",this.strip),item:B,el:A};},onStripMouseDown:function(B){if(B.button!=0){return ;}B.preventDefault();var A=this.findTargets(B);if(A.expand){this.toggleGroup(A.el);}else{if(A.item){if(A.isGroup){A.item.setActiveTab(A.item.getMainItem());}else{A.item.ownerCt.setActiveTab(A.item);}}}},expandGroup:function(A){if(A.isXType){A=this.getGroupEl(A);}Ext.fly(A).addClass("x-grouptabs-expanded");this.syncTabJoint();},toggleGroup:function(A){if(A.isXType){A=this.getGroupEl(A);}Ext.fly(A).toggleClass("x-grouptabs-expanded");this.syncTabJoint();},collapseGroup:function(A){if(A.isXType){A=this.getGroupEl(A);}Ext.fly(A).removeClass("x-grouptabs-expanded");this.syncTabJoint();},syncTabJoint:function(B){if(!this.tabJoint){return ;}B=B||this.getGroupEl(this.activeGroup);if(B){this.tabJoint.setHeight(Ext.fly(B).getHeight()-2);var A=Ext.isGecko2?0:1;if(this.tabPosition=="left"){this.tabJoint.alignTo(B,"tl-tr",[-2,A]);}else{this.tabJoint.alignTo(B,"tr-tl",[1,A]);}}else{this.tabJoint.hide();}},getActiveTab:function(){if(!this.activeGroup){return null;}return this.activeGroup.getTabEl(this.activeGroup.activeTab)||null;},onResize:function(){Ext.ux.GroupTabPanel.superclass.onResize.apply(this,arguments);this.syncTabJoint();},createCorner:function(A,B){return Ext.fly(A).createChild({cls:"x-grouptabs-corner x-grouptabs-corner-"+B});},initGroup:function(F,B){var D=this.strip.dom.childNodes[B],E=this.getTemplateArgs(F);if(B===0){E.cls+=" x-tab-first";}E.cls+=" x-grouptabs-main";E.text=F.getMainItem().title;var C=D?this.groupTpl.insertBefore(D,E):this.groupTpl.append(this.strip,E),A=this.createCorner(C,"top-"+this.tabPosition),G=this.createCorner(C,"bottom-"+this.tabPosition);F.tabEl=C;if(F.expanded){this.expandGroup(C);}if(Ext.isIE6||(Ext.isIE&&!Ext.isStrict)){G.setLeft("-10px");G.setBottom("-5px");A.setLeft("-10px");A.setTop("-5px");}this.mon(F,{scope:this,changemainitem:this.onGroupChangeMainItem,beforetabchange:this.onGroupBeforeTabChange});},setActiveGroup:function(B){B=this.getComponent(B);if(!B){return false;}if(!this.rendered){this.activeGroup=B;return true;}if(this.activeGroup!=B&&this.fireEvent("beforegroupchange",this,B,this.activeGroup)!==false){if(this.activeGroup){this.activeGroup.activeTab=null;var A=this.getGroupEl(this.activeGroup);if(A){Ext.fly(A).removeClass("x-grouptabs-strip-active");}}var C=this.getGroupEl(B);Ext.fly(C).addClass("x-grouptabs-strip-active");this.activeGroup=B;this.stack.add(B);this.layout.setActiveItem(B);this.syncTabJoint(C);this.fireEvent("groupchange",this,B);return true;}return false;},onGroupBeforeTabChange:function(A,C,B){if(A!==this.activeGroup||C!==B){this.strip.select(".x-grouptabs-sub > li.x-grouptabs-strip-active",true).removeClass("x-grouptabs-strip-active");}this.expandGroup(this.getGroupEl(A));if(A!==this.activeGroup){return this.setActiveGroup(A);}},getFrameHeight:function(){var A=this.el.getFrameWidth("tb");A+=(this.tbar?this.tbar.getHeight():0)+(this.bbar?this.bbar.getHeight():0);return A;},adjustBodyWidth:function(A){return A-this.tabWidth;}});Ext.reg("grouptabpanel",Ext.ux.GroupTabPanel);