Ext.ns("lib.FileUpload");lib.FileUpload.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"浏览".loc().concat("..."),buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){lib.FileUpload.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected");},onRender:function(C,A){lib.FileUpload.FileUploadField.superclass.onRender.call(this,C,A);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.createFileInput();var B=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText,tabIndex:this.tabIndex+1});this.button=new Ext.Button(Ext.apply(B,{renderTo:this.wrap,cls:"x-form-file-btn"+(B.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth());}this.bindListeners();this.resizeEl=this.positionEl=this.wrap;},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(["x-btn-over","x-btn-focus"]);},mouseleave:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"]);},mousedown:function(){this.button.addClass("x-btn-click");},mouseup:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"]);},change:function(){var A=this.fileInput.dom.value;A=A.substring(A.lastIndexOf("\\")+1);this.setValue(A);this.fireEvent("fileselected",this,A);}});},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1});},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();lib.FileUpload.FileUploadField.superclass.reset.call(this);},getFileInputId:function(){return this.id+"-file";},onResize:function(A,B){lib.FileUpload.FileUploadField.superclass.onResize.call(this,A,B);this.wrap.setWidth(A);if(!this.buttonOnly){var A=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(A);}},onDestroy:function(){lib.FileUpload.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap);},onDisable:function(){lib.FileUpload.FileUploadField.superclass.onDisable.call(this);this.doDisable(true);},onEnable:function(){lib.FileUpload.FileUploadField.superclass.onEnable.call(this);this.doDisable(false);},doDisable:function(A){this.fileInput.dom.disabled=A;this.button.setDisabled(A);},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0]);}});Ext.reg("fileuploadfield",lib.FileUpload.FileUploadField);Ext.form.FileUploadField=lib.FileUpload.FileUploadField;