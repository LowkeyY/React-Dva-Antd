Ext.namespace("etc","etc.configure");etc.configure.PersonalSet=Ext.extend(Ext.app.Module,{moduleType:"system",moduleId:"preferences",actions:null,layout:null,win:null,mainPanel:null,navPanel:null,scope:this,init:function(){this.launcher={handler:function(){this.createWindow();},iconCls:"icon-pref",scope:this,shortcutIconCls:"pref-shortcut-icon",text:"个人设置".loc(),tooltip:"<b>"+"设置个人信息".loc()+"</b><br/>"+"重置和更新个人信息!".loc()};window.ql=function(){};},createWindow:function(){var C=this.app.getDesktop();this.win=C.getWindow(this.moduleId);if(!this.win){var B=C.getWinWidth()/1.1;var A=C.getWinHeight()/1.1;using("lib.CachedPanel.CachedPanel");this.mainPanel=new lib.CachedPanel.CachedPanel({region:"center",margins:"0 0 0 0",activeTab:0,border:false,statusBar:true,statusConfig:{hidden:true},deferredRender:false,enableTabScroll:true,monitorResize:true});this.navPanel=new etc.configure.PersonalSet.NavPanel({owner:this,id:"nav"});this.win=C.createWindow({id:this.moduleId,title:"个人设置".loc(),iconCls:"icon-pref",width:B,height:A,border:true,frame:true,x:C.getWinX(B),y:C.getWinY(A),layoutConfig:{animate:true},shim:false,animCollapse:false,constrainHeader:true,layout:"border",items:[this.navPanel,this.mainPanel]});}this.win.show();},save:function(C){var E=this.app.getDesktop();var D=C.callback||null;var A=C.callbackScope||this;C.moduleId=this.moduleId;Ext.Ajax.request({url:this.app.connection,params:C,success:function(F){if(F&&F.responseText&&Ext.decode(F.responseText).success){B("成功".loc(),"保存成功.".loc());}else{if(Ext.decode(F.responseText).message){B("错误".loc(),Ext.decode(F.responseText).message);}else{B("错误".loc(),"服务器发生错误,不能正常保存配置信息.".loc());}}},failure:function(){B("错误".loc(),"失去与服务器连接.".loc());},scope:this});function B(G,F){Ext.msg(((G=="错误".loc())?"error":"info"),F);if(D){D.call(A);}}},viewCard:function(A){if(!this.mainPanel.havePanel(A)){var B=this.getContentPanel(A);this.mainPanel.add(B);}this.mainPanel.setActiveTab(A);},getContentPanel:function(A){if(A=="pass"){var B=new etc.configure.PersonalSet.PassWord({owner:this,id:"pass"});return B;}else{if(A=="profile"){loadcss("lib.upload.Base");using("lib.upload.Base");using("lib.upload.Image");return new etc.configure.PersonalSet.UserSet({owner:this,id:"profile"});}else{if(A=="setting"){using("bin.i18n.setting.LocaleSettingPanel");return new bin.i18n.setting.LocaleSettingPanel({name:"setting",bodyStyle:"padding:20px 15px 30px 20px;background:#FFFFFF;",cached:true,buttons:[{handler:function(){this.win.close();},scope:this,text:"关闭".loc()}]});}else{if(A=="activity"){return new etc.configure.PersonalSet.Activity({owner:this,id:"activity"});}else{if(A=="viewShortcuts"){return new etc.configure.PersonalSet.Shortcuts({owner:this,id:"viewShortcuts"});}else{if(A=="viewAutoRun"){return new etc.configure.PersonalSet.AutoRun({owner:this,id:"viewAutoRun"});}else{if(A=="viewQuickstart"){return new etc.configure.PersonalSet.QuickStart({owner:this,id:"viewQuickstart"});}else{if(A=="viewAppearance"){return new etc.configure.PersonalSet.Appearance({owner:this,id:"viewAppearance"});}else{if(A=="viewWallpapers"){return new etc.configure.PersonalSet.Background({owner:this,id:"viewWallpapers"});}}}}}}}}}}});etc.configure.PersonalSet.NavPanel=function(B){this.owner=B.owner;var A=get_cookie("user_id");if(A=="0"||A=="1"){this.profile="";this.storage="";}else{this.profile='<LI class=pass><A id="pass" href="#">'+"修改密码".loc()+'</A></LI><LI class=profile><A  id="profile" href="#" >'+"个人信息".loc()+"</A></LI>";this.storage='<LI class=chart><A id="space" href="#" >'+"空间信息".loc()+"</A></LI>";}etc.configure.PersonalSet.NavPanel.superclass.constructor.call(this,{containerScroll:true,rootVisible:false,region:"west",width:170,height:500,split:false,border:false,collapsible:false,autoScroll:false,margins:"0 0 0 0",html:"<DIV id=leftNav><H4>"+"基础信息".loc()+"</H4><UL>"+this.profile+((Ext.i18n&&Ext.i18n.enabled)?'<LI class=setting><A id="setting" href="#">'+"区域设置".loc()+"</A></LI>":"")+"</UL><H4>"+"外观设置".loc()+'</H4><UL><LI class=viewShortcuts><A id="viewShortcuts" href="#">'+"桌面启动程序".loc()+'</A></LI><LI class=viewAutoRun><A  id="viewAutoRun" href="#" >'+"自动执行程序".loc()+'</A></LI><LI class=viewQuickstart><A  id="viewQuickstart" href="#" >'+"快捷工具栏".loc()+'</A></LI><LI class=viewAppearance><A  id="viewAppearance" href="#" >'+"窗口颜色与外观".loc()+'</A></LI><LI class=viewWallpapers><A id="viewWallpapers" href="#">'+"桌面背景".loc()+"</A></LI></UL><H4>"+"使用信息".loc()+'</H4><UL><LI class=activity><A id="activity" href="#">'+"访问记录".loc()+"</A></LI></UL></UL></DIV>",id:B.id});this.actions={pass:function(C){C.viewCard("pass");},profile:function(C){C.viewCard("profile");},setting:function(C){C.viewCard("setting");},activity:function(C){C.viewCard("activity");},space:function(C){C.viewCard("space");},viewShortcuts:function(C){C.viewCard("viewShortcuts");},viewAutoRun:function(C){C.viewCard("viewAutoRun");},viewQuickstart:function(C){C.viewCard("viewQuickstart");},viewAppearance:function(C){C.viewCard("viewAppearance");},viewWallpapers:function(C){C.viewCard("viewWallpapers");}};};Ext.extend(etc.configure.PersonalSet.NavPanel,Ext.Panel,{afterRender:function(){this.body.on({mousedown:{fn:this.doAction,scope:this,delegate:"a"},click:{fn:Ext.emptyFn,scope:null,delegate:"a",preventDefault:true}});var A=get_cookie("user_id");if(A=="0"||A=="1"){this.owner.viewCard("pass");}else{this.owner.viewCard("pass");}etc.configure.PersonalSet.NavPanel.superclass.afterRender.call(this);},doAction:function(B,A){B.stopEvent();this.actions[A.id](this.owner);}});etc.configure.PersonalSet.PassWord=function(B){this.owner=B.owner;this.app=this.owner.app;using("lib.PasswordField.PasswordField");this.passwordForm=new Ext.FormPanel({labelWidth:200,labelAlign:"right",id:"passPanel",cached:false,border:false,bodyStyle:"padding:20px 15px 30px 0px;height:100%;width:100%;background:#FFFFFF;",items:[{layout:"column",border:false,items:[{columnWidth:1,layout:"form",border:false,items:[{xtype:"passwordfield",showCapsWarning:true,fieldLabel:"旧密码".loc(),name:"oldpasswd",width:150,maxLength:16,allowBlank:false,maxLengthText:"密码不能超过{0}个字符!".loc(),blankText:"旧密码必须提供.".loc()}]},{columnWidth:1,layout:"form",border:false,items:[{xtype:"passwordfield",showCapsWarning:true,showStrengthMeter:true,fieldLabel:"新密码".loc(),name:"passwd",width:150,maxLength:16,allowBlank:false,maxLengthText:"新密码不能超过{0}个字符!".loc(),blankText:"新密码必须提供.".loc()}]},{columnWidth:1,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"确认密码".loc(),name:"confirm_passwd",inputType:"password",width:150,maxLength:16,allowBlank:false,blankText:"确认密码必须提供.".loc(),maxLengthText:"确认密码不能超过{0}个字符!".loc()}]}]}]});etc.configure.PersonalSet.PassWord.superclass.constructor.call(this,{autoScroll:true,bodyStyle:"padding:10px",border:false,buttons:[{handler:C,scope:this,text:"保存".loc()},{handler:A,scope:this,text:"关闭".loc()}],id:B.id,items:this.passwordForm,title:"更新密码".loc()});function A(){this.owner.win.close();}function C(){this.buttons[0].disable();var F=this.passwordForm.form;var G=F.findField("confirm_passwd").getValue();var D=F.findField("passwd").getValue();var E=F.findField("oldpasswd").getValue();if(D==G){this.owner.save({callback:function(){this.buttons[0].enable();},callbackScope:this,task:"save",what:"password",passwd:D,oldpasswd:E});}else{Ext.msg("error","不能更新口令,确认密码与新密码不一致!".loc());this.buttons[0].enable();}}};Ext.extend(etc.configure.PersonalSet.PassWord,Ext.Panel);etc.configure.PersonalSet.Activity=function(B){this.owner=B.owner;this.app=this.owner.app;this.xg=Ext.grid;this.stasticDS=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.app.connection+"?moduleId="+this.owner.moduleId+"&task=load&what=log",method:"POST"}),autoLoad:false,reader:new Ext.data.JsonReader({root:"dataItem",totalProperty:"totalCount",id:"日期"},[{name:"日期",mapping:"日期"},{name:"当日访问人次",type:"int"},{name:"当日使用时间(分钟)",type:"int"},{name:"单次停留(分钟)",type:"int"}]),remoteSort:true});this.stasticDS.setDefaultSort("日期".loc(),"desc");this.cm=new Ext.grid.ColumnModel([new this.xg.RowNumberer(),{id:"日期",header:"日期".loc(),dataIndex:"日期",sortable:true,align:"right"},{header:"当日访问人次".loc(),dataIndex:"当日访问人次",sortable:true,align:"right"},{header:"当日使用时间(分钟)".loc(),dataIndex:"当日使用时间(分钟)",sortable:true,align:"right"},{header:"单次停留(分钟)".loc(),dataIndex:"单次停留(分钟)",sortable:true,align:"right"}]);this.cm.defaultSortable=true;this.activityGrid=new Ext.grid.GridPanel({store:this.stasticDS,cm:this.cm,autoScroll:true,trackMouseOver:true,loadMask:{msg:"数据载入中...".loc()},viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,getRowClass:this.applyRowClass},bbar:new Ext.PagingToolbar({pageSize:30,store:this.stasticDS,displayInfo:true,displayMsg:"{0}-{1}条 共:{2}条".loc(),emptyMsg:"没有数据".loc()})});this.store=this.stasticDS;etc.configure.PersonalSet.Activity.superclass.constructor.call(this,{autoScroll:false,border:false,layout:"fit",buttons:[{handler:A,scope:this,text:"关闭".loc()}],id:B.id,items:this.activityGrid,title:"访问日志".loc()});function A(){this.owner.win.close();}};Ext.extend(etc.configure.PersonalSet.Activity,Ext.Panel,{afterRender:function(){etc.configure.PersonalSet.Activity.superclass.afterRender.call(this);this.loadStore();},loadStore:function(){this.store.load();}});etc.configure.PersonalSet.UserSet=function(B){this.owner=B.owner;this.app=this.owner.app;var D="edit";this.userForm=new Ext.FormPanel({labelWidth:100,labelAlign:"right",id:"userSetPanel",border:false,cached:false,bodyStyle:"padding:20px 15px 30px 0px;height:100%;width:100%;background:#FFFFFF;",items:[{layout:"column",border:false,items:[{columnWidth:0.45,layout:"form",border:false,items:[new Ext.form.TextField({fieldLabel:"真实姓名".loc(),name:"real_name",width:150,maxLength:64,allowBlank:false,blankText:"真实姓名必须提供.".loc(),value:WorkBench.real_name,maxLengthText:"真实姓名不能超过{0}个字符!".loc()}),new Ext.form.TextField({fieldLabel:"电子邮件".loc(),name:"email",vtype:"email",width:150,maxLength:100}),new Ext.form.TextField({fieldLabel:"msn",name:"msn",vtype:"email",width:150,maxLength:50,maxLengthText:"msn不能超过50个字符!".loc()}),new Ext.form.TextField({fieldLabel:"电话".loc(),name:"phone",width:150,regex:/[0-9-./]/,regexText:"电话号码只能是数字,/,-".loc()}),new Ext.form.TextField({fieldLabel:"家庭电话".loc(),name:"phone_home",width:150,regex:/[0-9-./]/,regexText:"电话号码只能是数字,/,-".loc()}),new Ext.form.TextField({fieldLabel:"手机".loc(),name:"celler",width:150,regex:/[0-9-./]/,regexText:"手机号码只能是数字,/,-".loc(),maxText:"手机最大值不能大于 {0}".loc()})]},{columnWidth:0.55,layout:"form",border:false,items:[this.photoField=new lib.upload.Image({fieldLabel:"照片".loc(),name:"photo",id:"photo",allowBlank:true,state:D,txtStyle:'background-image: url("/lib/upload/images/nopicture.gif");',patternDescription:"照片文件".loc(),fileSizeMax:40*1024*1024,fileSizeMin:10*1024,loadFailureMessage:"无照片".loc(),chooseImageMessage:"点击此处上传照片".loc(),canvasWidth:170,canvasHeight:180,width:170})]}]},{layout:"column",border:false,items:[{columnWidth:1,layout:"form",border:false,items:[new Ext.form.TextArea({fieldLabel:"职责说明".loc(),name:"duty",width:550,height:60,maxLength:500,maxLengthText:"职责说明不能超过{0}个字符!".loc()})]}]}]});this.formDS=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.app.connection+"?moduleId="+this.owner.moduleId+"&task=load&what=profile",method:"post"}),reader:new Ext.data.JsonReader({},["real_name","email","phone","phone_home","celler","duty","msn","photo"]),remoteSort:false});this.store=this.formDS;etc.configure.PersonalSet.UserSet.superclass.constructor.call(this,{autoScroll:true,bodyStyle:"padding:10px",border:false,buttons:[{handler:C,scope:this,text:"保存".loc()},{handler:A,scope:this,text:"关闭".loc()}],id:B.id,items:this.userForm,title:"个人信息".loc()});this.store.on("load",function(F,E){var H=this.userForm.form;var G=this.store.getAt(0).data;H.findField("real_name").setValue(G.real_name);H.findField("phone").setValue(G.phone);H.findField("phone_home").setValue(G.phone_home);H.findField("celler").setValue(G.celler);H.findField("email").setValue(G.email);H.findField("msn").setValue(G.msn);H.findField("photo").setValue(G.photo);H.findField("duty").setValue(G.duty);},this);function A(){this.owner.win.close();}function C(){this.buttons[0].disable();var F=this.userForm.form;if(F.findField("photo").getValue()){lib.upload.Uploader.setEnctype(this.userForm);}var E={};E.task="save";E.what="profile";if(F.isValid()){F.submit({url:this.app.connection,params:E,method:"POST",scope:this,success:function(G,H){this.buttons[0].enable();if(H.result.items.id){this.photoField.setValue(H.result.items);}},failure:function(G,H){Ext.msg("error","数据提交失败!,原因:<br>".loc()+H.result.message);}});}else{Ext.msg("error","数据不能提交,请修改表单中标识的错误!".loc());}}};Ext.extend(etc.configure.PersonalSet.UserSet,Ext.Panel,{afterRender:function(){etc.configure.PersonalSet.UserSet.superclass.afterRender.call(this);this.loadStore();},loadStore:function(){this.store.load();}});etc.configure.PersonalSet.AutoRun=function(E){this.owner=E.owner;this.app=this.owner.app;var C=this.app.modules,A=this.app.desktop.config.autorun,D=B(C,A);etc.configure.PersonalSet.AutoRun.superclass.constructor.call(this,{autoScroll:true,bodyStyle:"padding:10px",border:false,buttons:[{handler:G,scope:this,text:"保存".loc()},{handler:I,scope:this,text:"关闭".loc()}],cls:"pref-card pref-check-tree",id:E.id,lines:false,listeners:{checkchange:{fn:H,scope:this}},loader:new Ext.tree.TreeLoader(),rootVisible:false,root:new Ext.tree.AsyncTreeNode({text:"自动启动程序".loc(),children:D}),title:"自动启动程序".loc()});function B(N,P){var M=[];for(var O=0,L=N.length;O<L;O++){var Q=N[O].launcher?N[O].launcher:N[O];if(N[O].moduleType=="Application"||N[O].moduleType=="system"){if(N[O].moduleId!="wb_help"&&N[O].moduleId!="preferences"){if(Q.menu){var K=J(Q.subModules,P);M.push({leaf:false,text:(Q.text||Q.menuText).loc(),children:K});}else{M.push({checked:F(N[O].moduleId,P)?true:false,iconCls:N[O].launcher.iconCls,icon:N[O].launcher.icon,id:N[O].moduleId,leaf:true,selected:true,text:(Q.text||Q.menuText).loc()});}}}}return M;}function J(M,O){var L=[];for(var N=0,K=M.length;N<K;N++){var P=M[N].launcher?M[N].launcher:M[N];L.push({checked:F(M[N].moduleId,O)?true:false,iconCls:M[N].launcher.iconCls,icon:M[N].launcher.icon,id:M[N].moduleId,leaf:true,selected:true,text:(P.text||P.menuText).loc()});}return L;}function F(N,M){for(var L=0,K=M.length;L<K;L++){if(N==M[L]){return true;}}}function H(L,K){if(L.leaf&&L.id){if(K){this.app.desktop.addAutoRun(L.id);}else{this.app.desktop.removeAutoRun(L.id);}}L.ownerTree.selModel.select(L);}function I(){this.owner.win.close();}function G(){this.buttons[0].disable();this.owner.save({callback:function(){this.buttons[0].enable();},callbackScope:this,task:"save",what:"autorun",ids:Ext.encode(this.app.desktop.config.autorun)});}};Ext.extend(etc.configure.PersonalSet.AutoRun,Ext.tree.TreePanel);etc.configure.PersonalSet.Shortcuts=function(E){this.owner=E.owner;this.app=this.owner.app;var C=this.app.modules,A=this.app.desktop.config.shortcuts,D=B(C,A);etc.configure.PersonalSet.Shortcuts.superclass.constructor.call(this,{autoScroll:true,bodyStyle:"padding:10px",border:false,buttons:[{handler:G,scope:this,text:"保存".loc()},{handler:I,scope:this,text:"关闭".loc()}],cls:"pref-card pref-check-tree",id:E.id,lines:false,listeners:{checkchange:{fn:H,scope:this}},loader:new Ext.tree.TreeLoader(),rootVisible:false,root:new Ext.tree.AsyncTreeNode({text:"桌面启动程序".loc(),children:D}),title:"桌面启动程序".loc()});function B(N,P){var M=[];for(var O=0,L=N.length;O<L;O++){var Q=N[O].launcher?N[O].launcher:N[O];if(N[O].moduleType=="Application"||N[O].moduleType=="system"){if(Q.menu){var K=J(Q.subModules,P);M.push({leaf:false,text:(Q.text||Q.menuText).loc(),children:K});}else{M.push({checked:F(N[O].moduleId,P)?true:false,iconCls:N[O].launcher.iconCls,icon:N[O].launcher.icon,id:N[O].moduleId,leaf:true,selected:true,text:(Q.text||Q.menuText).loc()});}}}return M;}function J(M,O){var L=[];for(var N=0,K=M.length;N<K;N++){var P=M[N].launcher?M[N].launcher:M[N];L.push({checked:F(M[N].moduleId,O)?true:false,iconCls:M[N].launcher.iconCls,icon:M[N].launcher.icon,id:M[N].moduleId,leaf:true,selected:true,text:(P.text||P.menuText).loc()});}return L;}function F(N,M){if(M){for(var L=0,K=M.length;L<K;L++){if(N==M[L]){return true;}}}}function H(L,K){if(L.leaf&&L.id){if(K){this.app.desktop.addShortcut(L.id,true);}else{this.app.desktop.removeShortcut(L.id,true);}}L.ownerTree.selModel.select(L);}function I(){this.owner.win.close();}function G(){this.buttons[0].disable();this.owner.save({callback:function(){this.buttons[0].enable();},callbackScope:this,task:"save",what:"shortcut",ids:Ext.encode(this.app.desktop.config.shortcuts)});}};Ext.extend(etc.configure.PersonalSet.Shortcuts,Ext.tree.TreePanel);etc.configure.PersonalSet.QuickStart=function(E){this.owner=E.owner;this.app=this.owner.app;var C=this.app.modules;var A=this.app.desktop.config.quickstart;var D=B(C,A);etc.configure.PersonalSet.QuickStart.superclass.constructor.call(this,{autoScroll:true,bodyStyle:"padding:10px",border:false,buttons:[{handler:G,scope:this,text:"保存".loc()},{handler:I,scope:this,text:"关闭".loc()}],cls:"pref-card pref-check-tree",id:E.id,lines:false,listeners:{checkchange:{fn:H,scope:this}},loader:new Ext.tree.TreeLoader(),rootVisible:false,root:new Ext.tree.AsyncTreeNode({text:"快捷工具栏".loc(),children:D}),title:"快捷工具栏".loc()});function B(N,P){var M=[];for(var O=0,L=N.length;O<L;O++){var Q=N[O].launcher?N[O].launcher:N[O];if(N[O].moduleType=="Application"||N[O].moduleType=="system"){if(Q.menu){var K=J(Q.subModules,P);M.push({leaf:false,text:(Q.text||Q.menuText).loc(),children:K});}else{M.push({checked:F(N[O].moduleId,P)?true:false,iconCls:N[O].launcher.iconCls,id:N[O].moduleId,leaf:true,selected:true,text:(Q.text||Q.menuText).loc()});}}}return M;}function J(M,O){var L=[];for(var N=0,K=M.length;N<K;N++){var P=M[N].launcher?M[N].launcher:M[N];L.push({checked:F(M[N].moduleId,O)?true:false,iconCls:M[N].launcher.iconCls,id:M[N].moduleId,leaf:true,selected:true,text:(P.text||P.menuText).loc()});}return L;}function F(N,M){if(M){for(var L=0,K=M.length;L<K;L++){if(N==M[L]){return true;}}}}function H(L,K){if(L.leaf&&L.id){if(K){this.app.desktop.addQuickStartButton(L.id,true);}else{this.app.desktop.removeQuickStartButton(L.id,true);}}L.ownerTree.selModel.select(L);}function I(){this.owner.win.close();}function G(){this.buttons[0].disable();this.owner.save({callback:function(){this.buttons[0].enable();},callbackScope:this,task:"save",what:"quickstart",ids:Ext.encode(this.app.desktop.config.quickstart)});}};Ext.extend(etc.configure.PersonalSet.QuickStart,Ext.tree.TreePanel);etc.configure.PersonalSet.Appearance=function(B){this.owner=B.owner;this.app=this.owner.app;var M=this.app.getDesktop();var L=new Ext.data.JsonStore({baseParams:{moduleId:this.owner.moduleId,task:"load",what:"themes"},fields:["id","name","pathtothumbnail","pathtofile"],id:"id",root:"images",url:this.app.connection});this.store=L;L.on("load",function(O,N){if(N){D.setTitle("共有".loc()+"("+N.length+")"+"个主题".loc());var P=this.app.desktop.config.styles.theme.id;if(P){J.select(String(P));}}},this);var G=new Ext.XTemplate('<tpl for=".">','<div class="pref-view-thumb-wrap" id="{id}">','<div class="pref-view-thumb"><img src="{pathtothumbnail}" title="{name}" /></div>',"<span>{shortName}</span></div>","</tpl>",'<div class="x-clear"></div>');var J=new Ext.DataView({autoHeight:true,cls:"pref-thumnail-view",emptyText:"没有可供选择的主题".loc(),itemSelector:"div.pref-view-thumb-wrap",loadingText:"载入中...".loc(),singleSelect:true,overClass:"x-view-over",prepareData:function(N){N.shortName=Ext.util.Format.ellipsis(N.name,17);return N;},store:L,tpl:G});J.on("selectionchange",E,this);var D=new Ext.Panel({animCollapse:false,baseCls:"collapse-group",border:false,cls:"pref-thumbnail-viewer",collapsible:true,hideCollapseTool:true,id:"pref-theme-view",items:J,title:"缺省主题".loc(),titleCollapse:true});var K=new Ext.Panel({autoScroll:true,bodyStyle:"padding:10px",border:true,cls:"pref-card-subpanel",id:"themes",items:D,margins:"10 15 0 15",region:"center"});var H=new Ext.form.Checkbox({checked:this.app.desktop.config.styles.transparency?true:false,x:150,y:15});H.on("check",C,this);var A=new Ext.FormPanel({border:false,height:70,items:[{x:15,y:15,xtype:"label",text:"任务栏透明处理".loc()},H],layout:"absolute",split:false,region:"south"});etc.configure.PersonalSet.Appearance.superclass.constructor.call(this,{border:false,buttons:[{handler:F,scope:this,text:"保存".loc()},{handler:I,scope:this,text:"关闭".loc()}],cls:"pref-card",id:B.id,items:[K],layout:"border",title:"窗口颜色与外观".loc()});function I(){this.owner.win.close();}function F(){var N=this.app.desktop.config.styles;this.buttons[0].disable();this.owner.save({callback:function(){this.buttons[0].enable();},callbackScope:this,task:"save",what:"appearance",backgroundcolor:N.backgroundcolor,fontcolor:N.fontcolor,theme:N.theme.id,transparency:N.transparency,wallpaper:N.wallpaper.id,wallpaperposition:N.wallpaperposition});}function E(O,Q){if(Q.length>0){var N=this.app.desktop.config.styles.theme.id,P=O.getRecord(Q[0]),R=P.data;if(parseInt(N)!==parseInt(P.id)){if(P&&P.id&&R.name&&R.pathtofile){M.setTheme({id:P.id,name:R.name,pathtofile:R.pathtofile});}}}}function C(O,N){if(N){M.setTransparency(80);}else{M.setTransparency(30);}}};Ext.extend(etc.configure.PersonalSet.Appearance,Ext.Panel,{afterRender:function(){etc.configure.PersonalSet.Background.superclass.afterRender.call(this);this.loadStore();},loadStore:function(){this.store.load();}});etc.configure.PersonalSet.Background=function(S){this.owner=S.owner;this.app=this.owner.app;var O=this.app.getDesktop();var C=new Ext.data.JsonStore({baseParams:{moduleId:this.owner.moduleId,task:"load",what:"wallpapers"},fields:["id","name","pathtothumbnail","pathtofile"],id:"id",root:"images",url:this.app.connection});this.store=C;C.on("load",function(X,W){if(W){F.setTitle("缺省墙纸".loc()+"("+W.length+")"+"个".loc());var Y=this.app.desktop.config.styles.wallpaper.id;if(Y){I.select("wallpaper-"+Y);}}},this);var U=new Ext.XTemplate('<tpl for=".">','<div class="pref-view-thumb-wrap" id="{id}">','<div class="pref-view-thumb"><img src="{pathtothumbnail}" title="{name}" /></div>',"<span>{shortName}</span></div>","</tpl>",'<div class="x-clear"></div>');var I=new Ext.DataView({autoHeight:true,cls:"pref-thumnail-view",emptyText:"没有可供选择的墙纸".loc(),itemSelector:"div.pref-view-thumb-wrap",loadingText:"载入中...".loc(),singleSelect:true,overClass:"x-view-over",prepareData:function(W){W.shortName=Ext.util.Format.ellipsis(W.name,17);return W;},store:C,tpl:U});var I=new Ext.DataView({autoHeight:true,cls:"pref-thumnail-view",emptyText:"没有要显示的墙纸".loc(),itemSelector:"div.pref-view-thumb-wrap",loadingText:"载入中...".loc(),singleSelect:true,overClass:"x-view-over",prepareData:function(W){W.shortName=Ext.util.Format.ellipsis(W.name,17);return W;},store:C,tpl:U});I.on("selectionchange",H,this);var F=new Ext.Panel({animCollapse:false,baseCls:"collapse-group",border:false,cls:"pref-thumbnail-viewer",collapsible:true,hideCollapseTool:true,id:"pref-wallpaper-view",items:I,title:"缺省墙纸".loc(),titleCollapse:true});var D=new Ext.Panel({autoScroll:true,bodyStyle:"padding:10px",border:true,cls:"pref-card-subpanel",id:"wallpapers",items:F,margins:"10 15 0 15",region:"center"});var K=this.app.desktop.config.styles.wallpaperposition;var N=P("tile",K=="tile"?true:false,90,40);var G=P("center",K=="center"?true:false,200,40);var T=new Ext.FormPanel({border:false,height:140,id:"position",items:[{border:false,items:{border:false,html:"选择墙纸布局方式?".loc()},x:15,y:15},{border:false,items:{border:false,html:'<span width="64" height="54" border="0" align="right"/>'+"平铺".loc()+":</span>"},x:15,y:40},N,{border:false,items:{border:false,html:'<span width="64" height="54" border="0" align="right"/>'+"拉伸".loc()+":</span>"},x:125,y:40},G,{border:false,items:{border:false,html:"选择背景色".loc()},x:245,y:15},{border:false,items:new Ext.ColorPalette({listeners:{select:{fn:M,scope:this}}}),x:245,y:40},{border:false,items:{border:false,html:"选择字体颜色".loc()},x:425,y:15},{border:false,items:new Ext.ColorPalette({listeners:{select:{fn:L,scope:this}}}),x:425,y:40}],layout:"absolute",region:"south",split:false});etc.configure.PersonalSet.Background.superclass.constructor.call(this,{border:false,buttons:[{handler:J,scope:this,text:"保存".loc()},{handler:A,scope:this,text:"关闭".loc()}],cls:"pref-card",id:S.id,items:[D,T],layout:"border",title:"桌面背景".loc()});function P(Y,X,W,Z){if(Y){radio=new Ext.form.Radio({name:"position",inputValue:Y,checked:X,x:W,y:Z});radio.on("check",B,radio);return radio;}}function Q(W){W.el.on("click",E,W);}function E(){B(this,true);}function V(){colorDialog.show();}function A(){this.owner.win.close();}function R(X,W){O.setBackgroundColor(W);}function M(X,W){O.setBackgroundColor(W);}function L(X,W){O.setFontColor(W);}function J(){var W=this.app.desktop.config.styles;this.buttons[0].disable();this.owner.save({callback:function(){this.buttons[0].enable();},callbackScope:this,task:"save",what:"appearance",backgroundcolor:W.backgroundcolor,fontcolor:W.fontcolor,theme:W.theme.id,transparency:W.transparency,wallpaper:W.wallpaper.id,wallpaperposition:W.wallpaperposition});}function H(X,Z){if(Z.length>0){var W=this.app.desktop.config.styles.wallpaper.id,Y=X.getRecord(Z[0]),a=Y.data;if(parseInt(W)!==parseInt(Y.id)){if(Y&&Y.id&&a.name&&a.pathtofile){O.setWallpaper({id:Y.id,name:a.name,pathtofile:a.pathtofile});}}}}function B(X,W){if(W===true){O.setWallpaperPosition(X.inputValue);}}};Ext.extend(etc.configure.PersonalSet.Background,Ext.Panel,{afterRender:function(){etc.configure.PersonalSet.Background.superclass.afterRender.call(this);this.loadStore();},loadStore:function(){this.store.load();}});Ext.override(Ext.tree.TreeNodeUI,{toggleCheck:function(B){var A=this.checkbox;if(A){A.checked=(B===undefined?!A.checked:B);this.fireEvent("checkchange",this.node,A.checked);}}});etc.configure.PersonalSet.TimeZones=[["Africa/Abidjan"],["Africa/Accra"],["Africa/Addis_Ababa"],["Africa/Algiers"],["Africa/Asmara"],["Africa/Asmera"],["Africa/Bamako"],["Africa/Bangui"],["Africa/Banjul"],["Africa/Bissau"],["Africa/Blantyre"],["Africa/Brazzaville"],["Africa/Bujumbura"],["Africa/Cairo"],["Africa/Casablanca"],["Africa/Ceuta"],["Africa/Conakry"],["Africa/Dakar"],["Africa/Dar_es_Salaam"],["Africa/Djibouti"],["Africa/Douala"],["Africa/El_Aaiun"],["Africa/Freetown"],["Africa/Gaborone"],["Africa/Harare"],["Africa/Johannesburg"],["Africa/Kampala"],["Africa/Khartoum"],["Africa/Kigali"],["Africa/Kinshasa"],["Africa/Lagos"],["Africa/Libreville"],["Africa/Lome"],["Africa/Luanda"],["Africa/Lubumbashi"],["Africa/Lusaka"],["Africa/Malabo"],["Africa/Maputo"],["Africa/Maseru"],["Africa/Mbabane"],["Africa/Mogadishu"],["Africa/Monrovia"],["Africa/Nairobi"],["Africa/Ndjamena"],["Africa/Niamey"],["Africa/Nouakchott"],["Africa/Ouagadougou"],["Africa/Porto-Novo"],["Africa/Sao_Tome"],["Africa/Timbuktu"],["Africa/Tripoli"],["Africa/Tunis"],["Africa/Windhoek"],["America/Adak"],["America/Anchorage"],["America/Anguilla"],["America/Antigua"],["America/Araguaina"],["America/Argentina/Buenos_Aires"],["America/Argentina/Catamarca"],["America/Argentina/ComodRivadavia"],["America/Argentina/Cordoba"],["America/Argentina/Jujuy"],["America/Argentina/La_Rioja"],["America/Argentina/Mendoza"],["America/Argentina/Rio_Gallegos"],["America/Argentina/San_Juan"],["America/Argentina/Tucuman"],["America/Argentina/Ushuaia"],["America/Aruba"],["America/Asuncion"],["America/Atikokan"],["America/Atka"],["America/Bahia"],["America/Barbados"],["America/Belem"],["America/Belize"],["America/Blanc-Sablon"],["America/Boa_Vista"],["America/Bogota"],["America/Boise"],["America/Buenos_Aires"],["America/Cambridge_Bay"],["America/Campo_Grande"],["America/Cancun"],["America/Caracas"],["America/Catamarca"],["America/Cayenne"],["America/Cayman"],["America/Chicago"],["America/Chihuahua"],["America/Coral_Harbour"],["America/Cordoba"],["America/Costa_Rica"],["America/Cuiaba"],["America/Curacao"],["America/Danmarkshavn"],["America/Dawson"],["America/Dawson_Creek"],["America/Denver"],["America/Detroit"],["America/Dominica"],["America/Edmonton"],["America/Eirunepe"],["America/El_Salvador"],["America/Ensenada"],["America/Fort_Wayne"],["America/Fortaleza"],["America/Glace_Bay"],["America/Godthab"],["America/Goose_Bay"],["America/Grand_Turk"],["America/Grenada"],["America/Guadeloupe"],["America/Guatemala"],["America/Guayaquil"],["America/Guyana"],["America/Halifax"],["America/Havana"],["America/Hermosillo"],["America/Indiana/Indianapolis"],["America/Indiana/Knox"],["America/Indiana/Marengo"],["America/Indiana/Petersburg"],["America/Indiana/Vevay"],["America/Indiana/Vincennes"],["America/Indiana/Winamac"],["America/Indianapolis"],["America/Inuvik"],["America/Iqaluit"],["America/Jamaica"],["America/Jujuy"],["America/Juneau"],["America/Kentucky/Louisville"],["America/Kentucky/Monticello"],["America/Knox_IN"],["America/La_Paz"],["America/Lima"],["America/Los_Angeles"],["America/Louisville"],["America/Maceio"],["America/Managua"],["America/Manaus"],["America/Martinique"],["America/Mazatlan"],["America/Mendoza"],["America/Menominee"],["America/Merida"],["America/Mexico_City"],["America/Miquelon"],["America/Moncton"],["America/Monterrey"],["America/Montevideo"],["America/Montreal"],["America/Montserrat"],["America/Nassau"],["America/New_York"],["America/Nipigon"],["America/Nome"],["America/Noronha"],["America/North_Dakota/Center"],["America/North_Dakota/New_Salem"],["America/Panama"],["America/Pangnirtung"],["America/Paramaribo"],["America/Phoenix"],["America/Port-au-Prince"],["America/Port_of_Spain"],["America/Porto_Acre"],["America/Porto_Velho"],["America/Puerto_Rico"],["America/Rainy_River"],["America/Rankin_Inlet"],["America/Recife"],["America/Regina"],["America/Resolute"],["America/Rio_Branco"],["America/Rosario"],["America/Santiago"],["America/Santo_Domingo"],["America/Sao_Paulo"],["America/Scoresbysund"],["America/Shiprock"],["America/St_Johns"],["America/St_Kitts"],["America/St_Lucia"],["America/St_Thomas"],["America/St_Vincent"],["America/Swift_Current"],["America/Tegucigalpa"],["America/Thule"],["America/Thunder_Bay"],["America/Tijuana"],["America/Toronto"],["America/Tortola"],["America/Vancouver"],["America/Virgin"],["America/Whitehorse"],["America/Winnipeg"],["America/Yakutat"],["America/Yellowknife"],["Antarctica/Casey"],["Antarctica/Davis"],["Antarctica/DumontDUrville"],["Antarctica/Mawson"],["Antarctica/McMurdo"],["Antarctica/Palmer"],["Antarctica/Rothera"],["Antarctica/South_Pole"],["Antarctica/Syowa"],["Antarctica/Vostok"],["Arctic/Longyearbyen"],["Asia/Aden"],["Asia/Almaty"],["Asia/Amman"],["Asia/Anadyr"],["Asia/Aqtau"],["Asia/Aqtobe"],["Asia/Ashgabat"],["Asia/Ashkhabad"],["Asia/Baghdad"],["Asia/Bahrain"],["Asia/Baku"],["Asia/Bangkok"],["Asia/Beirut"],["Asia/Bishkek"],["Asia/Brunei"],["Asia/Calcutta"],["Asia/Choibalsan"],["Asia/Chongqing"],["Asia/Chungking"],["Asia/Colombo"],["Asia/Dacca"],["Asia/Damascus"],["Asia/Dhaka"],["Asia/Dili"],["Asia/Dubai"],["Asia/Dushanbe"],["Asia/Gaza"],["Asia/Harbin"],["Asia/Hong_Kong"],["Asia/Hovd"],["Asia/Irkutsk"],["Asia/Istanbul"],["Asia/Jakarta"],["Asia/Jayapura"],["Asia/Jerusalem"],["Asia/Kabul"],["Asia/Kamchatka"],["Asia/Karachi"],["Asia/Kashgar"],["Asia/Katmandu"],["Asia/Krasnoyarsk"],["Asia/Kuala_Lumpur"],["Asia/Kuching"],["Asia/Kuwait"],["Asia/Macao"],["Asia/Macau"],["Asia/Magadan"],["Asia/Makassar"],["Asia/Manila"],["Asia/Muscat"],["Asia/Nicosia"],["Asia/Novosibirsk"],["Asia/Omsk"],["Asia/Oral"],["Asia/Phnom_Penh"],["Asia/Pontianak"],["Asia/Pyongyang"],["Asia/Qatar"],["Asia/Qyzylorda"],["Asia/Rangoon"],["Asia/Riyadh"],["Asia/Saigon"],["Asia/Sakhalin"],["Asia/Samarkand"],["Asia/Seoul"],["Asia/Shanghai"],["Asia/Singapore"],["Asia/Taipei"],["Asia/Tashkent"],["Asia/Tbilisi"],["Asia/Tehran"],["Asia/Tel_Aviv"],["Asia/Thimbu"],["Asia/Thimphu"],["Asia/Tokyo"],["Asia/Ujung_Pandang"],["Asia/Ulaanbaatar"],["Asia/Ulan_Bator"],["Asia/Urumqi"],["Asia/Vientiane"],["Asia/Vladivostok"],["Asia/Yakutsk"],["Asia/Yekaterinburg"],["Asia/Yerevan"],["Atlantic/Azores"],["Atlantic/Bermuda"],["Atlantic/Canary"],["Atlantic/Cape_Verde"],["Atlantic/Faeroe"],["Atlantic/Faroe"],["Atlantic/Jan_Mayen"],["Atlantic/Madeira"],["Atlantic/Reykjavik"],["Atlantic/South_Georgia"],["Atlantic/St_Helena"],["Atlantic/Stanley"],["Australia/ACT"],["Australia/Adelaide"],["Australia/Brisbane"],["Australia/Broken_Hill"],["Australia/Canberra"],["Australia/Currie"],["Australia/Darwin"],["Australia/Eucla"],["Australia/Hobart"],["Australia/LHI"],["Australia/Lindeman"],["Australia/Lord_Howe"],["Australia/Melbourne"],["Australia/North"],["Australia/NSW"],["Australia/Perth"],["Australia/Queensland"],["Australia/South"],["Australia/Sydney"],["Australia/Tasmania"],["Australia/Victoria"],["Australia/West"],["Australia/Yancowinna"],["Brazil/Acre"],["Brazil/DeNoronha"],["Brazil/East"],["Brazil/West"],["Canada/Atlantic"],["Canada/Central"],["Canada/East-Saskatchewan"],["Canada/Eastern"],["Canada/Mountain"],["Canada/Newfoundland"],["Canada/Pacific"],["Canada/Saskatchewan"],["Canada/Yukon"],["CET"],["Chile/Continental"],["Chile/EasterIsland"],["CST6CDT"],["Cuba"],["EET"],["Egypt"],["Eire"],["EST"],["EST5EDT"],["Etc/GMT"],["Etc/GMT+0"],["Etc/GMT+1"],["Etc/GMT+10"],["Etc/GMT+11"],["Etc/GMT+12"],["Etc/GMT+2"],["Etc/GMT+3"],["Etc/GMT+4"],["Etc/GMT+5"],["Etc/GMT+6"],["Etc/GMT+7"],["Etc/GMT+8"],["Etc/GMT+9"],["Etc/GMT-0"],["Etc/GMT-1"],["Etc/GMT-10"],["Etc/GMT-11"],["Etc/GMT-12"],["Etc/GMT-13"],["Etc/GMT-14"],["Etc/GMT-2"],["Etc/GMT-3"],["Etc/GMT-4"],["Etc/GMT-5"],["Etc/GMT-6"],["Etc/GMT-7"],["Etc/GMT-8"],["Etc/GMT-9"],["Etc/GMT0"],["Etc/Greenwich"],["Etc/UCT"],["Etc/Universal"],["Etc/UTC"],["Etc/Zulu"],["Europe/Amsterdam"],["Europe/Andorra"],["Europe/Athens"],["Europe/Belfast"],["Europe/Belgrade"],["Europe/Berlin"],["Europe/Bratislava"],["Europe/Brussels"],["Europe/Bucharest"],["Europe/Budapest"],["Europe/Chisinau"],["Europe/Copenhagen"],["Europe/Dublin"],["Europe/Gibraltar"],["Europe/Guernsey"],["Europe/Helsinki"],["Europe/Isle_of_Man"],["Europe/Istanbul"],["Europe/Jersey"],["Europe/Kaliningrad"],["Europe/Kiev"],["Europe/Lisbon"],["Europe/Ljubljana"],["Europe/London"],["Europe/Luxembourg"],["Europe/Madrid"],["Europe/Malta"],["Europe/Mariehamn"],["Europe/Minsk"],["Europe/Monaco"],["Europe/Moscow"],["Europe/Nicosia"],["Europe/Oslo"],["Europe/Paris"],["Europe/Podgorica"],["Europe/Prague"],["Europe/Riga"],["Europe/Rome"],["Europe/Samara"],["Europe/San_Marino"],["Europe/Sarajevo"],["Europe/Simferopol"],["Europe/Skopje"],["Europe/Sofia"],["Europe/Stockholm"],["Europe/Tallinn"],["Europe/Tirane"],["Europe/Tiraspol"],["Europe/Uzhgorod"],["Europe/Vaduz"],["Europe/Vatican"],["Europe/Vienna"],["Europe/Vilnius"],["Europe/Volgograd"],["Europe/Warsaw"],["Europe/Zagreb"],["Europe/Zaporozhye"],["Europe/Zurich"],["Factory"],["GB"],["GB-Eire"],["GMT+0"],["GMT-0"],["GMT0"],["Greenwich"],["Hongkong"],["HST"],["Iceland"],["Indian/Antananarivo"],["Indian/Chagos"],["Indian/Christmas"],["Indian/Cocos"],["Indian/Comoro"],["Indian/Kerguelen"],["Indian/Mahe"],["Indian/Maldives"],["Indian/Mauritius"],["Indian/Mayotte"],["Indian/Reunion"],["Iran"],["Israel"],["Jamaica"],["Japan"],["Kwajalein"],["Libya"],["MET"],["Mexico/BajaNorte"],["Mexico/BajaSur"],["Mexico/General"],["MST"],["MST7MDT"],["Navajo"],["NZ"],["NZ-CHAT"],["Pacific/Apia"],["Pacific/Auckland"],["Pacific/Chatham"],["Pacific/Easter"],["Pacific/Efate"],["Pacific/Enderbury"],["Pacific/Fakaofo"],["Pacific/Fiji"],["Pacific/Funafuti"],["Pacific/Galapagos"],["Pacific/Gambier"],["Pacific/Guadalcanal"],["Pacific/Guam"],["Pacific/Honolulu"],["Pacific/Johnston"],["Pacific/Kiritimati"],["Pacific/Kosrae"],["Pacific/Kwajalein"],["Pacific/Majuro"],["Pacific/Marquesas"],["Pacific/Midway"],["Pacific/Nauru"],["Pacific/Niue"],["Pacific/Norfolk"],["Pacific/Noumea"],["Pacific/Pago_Pago"],["Pacific/Palau"],["Pacific/Pitcairn"],["Pacific/Ponape"],["Pacific/Port_Moresby"],["Pacific/Rarotonga"],["Pacific/Saipan"],["Pacific/Samoa"],["Pacific/Tahiti"],["Pacific/Tarawa"],["Pacific/Tongatapu"],["Pacific/Truk"],["Pacific/Wake"],["Pacific/Wallis"],["Pacific/Yap"],["Poland"],["Portugal"],["PRC"],["PST8PDT"],["ROC"],["ROK"],["Singapore"],["Turkey"],["UCT"],["Universal"],["US/Alaska"],["US/Aleutian"],["US/Arizona"],["US/Central"],["US/East-Indiana"],["US/Eastern"],["US/Hawaii"],["US/Indiana-Starke"],["US/Michigan"],["US/Mountain"],["US/Pacific"],["US/Pacific-New"],["US/Samoa"],["W-SU"],["WET"],["Zulu"]];