FCKCommands.RegisterCommand("Placeholder",new FCKDialogCommand("Placeholder",FCKLang.PlaceholderDlgTitle,FCKPlugins.Items.placeholder.Path+"fck_placeholder.html",340,160));var oPlaceholderItem=new FCKToolbarButton("Placeholder",FCKLang.PlaceholderBtn);oPlaceholderItem.IconPath=FCKPlugins.Items.placeholder.Path+"placeholder.gif";FCKToolbarItems.RegisterItem("Placeholder",oPlaceholderItem);var FCKPlaceholders=new Object();FCKPlaceholders.Add=function(A){var B=FCK.InsertElement("span");this.SetupSpan(B,A);};FCKPlaceholders.SetupSpan=function(B,A){B.innerHTML="[[ "+A+" ]]";B.style.backgroundColor="#ffff00";B.style.color="#000000";if(FCKBrowserInfo.IsGecko){B.style.cursor="default";}B._fckplaceholder=A;B.contentEditable=false;B.onresizestart=function(){FCK.EditorWindow.event.returnValue=false;return false;};};FCKPlaceholders._SetupClickListener=function(){FCKPlaceholders._ClickListener=function(A){if(A.target.tagName=="SPAN"&&A.target._fckplaceholder){FCKSelection.SelectNode(A.target);}};FCK.EditorDocument.addEventListener("click",FCKPlaceholders._ClickListener,true);};FCKPlaceholders.OnDoubleClick=function(A){if(A.tagName=="SPAN"&&A._fckplaceholder){FCKCommands.GetCommand("Placeholder").Execute();}};FCK.RegisterDoubleClickHandler(FCKPlaceholders.OnDoubleClick,"SPAN");FCKPlaceholders.Exist=function(B){var A=FCK.EditorDocument.getElementsByTagName("SPAN");for(var C=0;C<A.length;C++){if(A[C]._fckplaceholder==B){return true;}}return false;};if(FCKBrowserInfo.IsIE){FCKPlaceholders.Redraw=function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG){return ;}var A=FCK.EditorDocument.body.innerText.match(/\[\[[^\[\]]+\]\]/g);if(!A){return ;}var D=FCK.EditorDocument.body.createTextRange();for(var B=0;B<A.length;B++){if(D.findText(A[B])){var C=A[B].match(/\[\[\s*([^\]]*?)\s*\]\]/)[1];D.pasteHTML('<span style="color: #000000; background-color: #ffff00" contenteditable="false" _fckplaceholder="'+C+'">'+A[B]+"</span>");}}};}else{FCKPlaceholders.Redraw=function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG){return ;}var D=FCK.EditorDocument.createTreeWalker(FCK.EditorDocument.body,NodeFilter.SHOW_TEXT,FCKPlaceholders._AcceptNode,true);var A=new Array();while((oNode=D.nextNode())){A[A.length]=oNode;}for(var G=0;G<A.length;G++){var C=A[G].nodeValue.split(/(\[\[[^\[\]]+\]\])/g);for(var B=0;B<C.length;B++){if(C[B].length>0){if(C[B].indexOf("[[")==0){var F=C[B].match(/\[\[\s*([^\]]*?)\s*\]\]/)[1];var E=FCK.EditorDocument.createElement("span");FCKPlaceholders.SetupSpan(E,F);A[G].parentNode.insertBefore(E,A[G]);}else{A[G].parentNode.insertBefore(FCK.EditorDocument.createTextNode(C[B]),A[G]);}}}A[G].parentNode.removeChild(A[G]);}FCKPlaceholders._SetupClickListener();};FCKPlaceholders._AcceptNode=function(A){if(/\[\[[^\[\]]+\]\]/.test(A.nodeValue)){return NodeFilter.FILTER_ACCEPT;}else{return NodeFilter.FILTER_SKIP;}};}FCK.Events.AttachEvent("OnAfterSetHTML",FCKPlaceholders.Redraw);FCKXHtml.TagProcessors.span=function(A,B){if(B._fckplaceholder){A=FCKXHtml.XML.createTextNode("[["+B._fckplaceholder+"]]");}else{FCKXHtml._AppendChildNodes(A,B,false);}return A;};