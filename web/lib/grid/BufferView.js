Ext.ns("lib.grid");lib.grid.BufferView=Ext.extend(Ext.grid.GridView,{rowHeight:19,borderHeight:2,scrollDelay:100,cacheSize:20,cleanDelay:500,initTemplates:function(){lib.grid.BufferView.superclass.initTemplates.call(this);var A=this.templates;A.rowHolder=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"></div>');A.rowHolder.disableFormats=true;A.rowHolder.compile();A.rowBody=new Ext.Template('<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table>");A.rowBody.disableFormats=true;A.rowBody.compile();},getStyleRowHeight:function(){return Ext.isBorderBox?(this.rowHeight+this.borderHeight):this.rowHeight;},getCalculatedRowHeight:function(){return this.rowHeight+this.borderHeight;},getVisibleRowCount:function(){var B=this.getCalculatedRowHeight(),A=this.scroller.dom.clientHeight;return(A<1)?0:Math.ceil(A/B);},getVisibleRows:function(){var A=this.getVisibleRowCount(),B=this.scroller.dom.scrollTop,C=(B===0?0:Math.floor(B/this.getCalculatedRowHeight())-1);return{first:Math.max(C,0),last:Math.min(C+A+2,this.ds.getCount()-1)};},doRender:function(F,H,P,A,N,V,I){var B=this.templates,E=B.cell,G=B.row,S=B.rowBody,K=N-1,O=this.getStyleRowHeight(),U=this.getVisibleRows(),C="width:"+this.getTotalWidth()+";height:"+O+"px;",Y=[],R,Z,Q={},J={tstyle:C},M;for(var T=0,X=H.length;T<X;T++){M=H[T];R=[];var L=(T+A),D=L>=U.first&&L<=U.last;if(D){for(var W=0;W<N;W++){Z=F[W];Q.id=Z.id;Q.css=W===0?"x-grid3-cell-first ":(W==K?"x-grid3-cell-last ":"");Q.attr=Q.cellAttr="";Q.value=Z.renderer(M.data[Z.name],Q,M,L,W,P);Q.style=Z.style;if(Q.value===undefined||Q.value===""){Q.value="&#160;";}if(M.dirty&&typeof M.modified[Z.name]!=="undefined"){Q.css+=" x-grid3-dirty-cell";}R[R.length]=E.apply(Q);}}var a=[];if(V&&((L+1)%2===0)){a[0]="x-grid3-row-alt";}if(M.dirty){a[1]=" x-grid3-dirty-row";}J.cols=N;if(this.getRowClass){a[2]=this.getRowClass(M,L,J,P);}J.alt=a.join(" ");J.cells=R.join("");Y[Y.length]=!D?B.rowHolder.apply(J):(I?S.apply(J):G.apply(J));}return Y.join("");},isRowRendered:function(A){var B=this.getRow(A);return B&&B.childNodes.length>0;},syncScroll:function(){lib.grid.BufferView.superclass.syncScroll.apply(this,arguments);this.update();},update:function(){if(this.scrollDelay){if(!this.renderTask){this.renderTask=new Ext.util.DelayedTask(this.doUpdate,this);}this.renderTask.delay(this.scrollDelay);}else{this.doUpdate();}},onRemove:function(D,A,B,C){lib.grid.BufferView.superclass.onRemove.apply(this,arguments);if(C!==true){this.update();}},doUpdate:function(){if(this.getVisibleRowCount()>0){var F=this.grid,B=F.colModel,G=F.store,E=this.getColumnData(),A=this.getVisibleRows(),H;for(var D=A.first;D<=A.last;D++){if(!this.isRowRendered(D)&&(H=this.getRow(D))){var C=this.doRender(E,[G.getAt(D)],G,D,B.getColumnCount(),F.stripeRows,true);H.innerHTML=C;}}this.clean();}},clean:function(){if(!this.cleanTask){this.cleanTask=new Ext.util.DelayedTask(this.doClean,this);}this.cleanTask.delay(this.cleanDelay);},doClean:function(){if(this.getVisibleRowCount()>0){var B=this.getVisibleRows();B.first-=this.cacheSize;B.last+=this.cacheSize;var C=0,D=this.getRows();if(B.first<=0){C=B.last+1;}for(var A=this.ds.getCount();C<A;C++){if((C<B.first||C>B.last)&&D[C].innerHTML){D[C].innerHTML="";}}}},removeTask:function(B){var A=this[B];if(A&&A.cancel){A.cancel();this[B]=null;}},destroy:function(){this.removeTask("cleanTask");this.removeTask("renderTask");lib.grid.BufferView.superclass.destroy.call(this);},layout:function(){lib.grid.BufferView.superclass.layout.call(this);this.update();}});