Ext.namespace("lib.GroupTab");Ext.ux.GroupTab=Ext.extend(Ext.Container,{mainItem:0,expanded:true,deferredRender:true,activeTab:null,idDelimiter:"__",headerAsText:false,frame:false,hideBorders:true,initComponent:function(A){Ext.apply(this,A);this.frame=false;Ext.ux.GroupTab.superclass.initComponent.call(this);this.addEvents("activate","deactivate","changemainitem","beforetabchange","tabchange");this.setLayout(new Ext.layout.CardLayout({deferredRender:this.deferredRender}));if(!this.stack){this.stack=Ext.TabPanel.AccessStack();}this.initItems();this.on("beforerender",function(){this.groupEl=this.ownerCt.getGroupEl(this);},this);this.on("add",this.onAdd,this,{target:this});this.on("remove",this.onRemove,this,{target:this});if(this.mainItem!==undefined){var B=(typeof this.mainItem=="object")?this.mainItem:this.items.get(this.mainItem);delete this.mainItem;this.setMainItem(B);}},setActiveTab:function(C){C=this.getComponent(C);if(!C){return false;}if(!this.rendered){this.activeTab=C;return true;}if(this.activeTab!=C&&this.fireEvent("beforetabchange",this,C,this.activeTab)!==false){if(this.activeTab&&this.activeTab!=this.mainItem){var A=this.getTabEl(this.activeTab);if(A){Ext.fly(A).removeClass("x-grouptabs-strip-active");}}var B=this.getTabEl(C);Ext.fly(B).addClass("x-grouptabs-strip-active");this.activeTab=C;this.stack.add(C);this.layout.setActiveItem(C);if(this.layoutOnTabChange&&C.doLayout){C.doLayout();}if(this.scrolling){this.scrollToTab(C,this.animScroll);}this.fireEvent("tabchange",this,C);return true;}return false;},getTabEl:function(A){if(A==this.mainItem){return this.groupEl;}return Ext.TabPanel.prototype.getTabEl.call(this,A);},onRender:function(B,A){Ext.ux.GroupTab.superclass.onRender.call(this,B,A);this.strip=Ext.fly(this.groupEl).createChild({tag:"ul",cls:"x-grouptabs-sub"});this.tooltip=new Ext.ToolTip({target:this.groupEl,delegate:"a.x-grouptabs-text",trackMouse:true,renderTo:document.body,listeners:{beforeshow:function(E){var D=(E.triggerElement.parentNode===this.mainItem.tabEl)?this.mainItem:this.findById(E.triggerElement.parentNode.id.split(this.idDelimiter)[1]);if(!D.tabTip){return false;}E.body.dom.innerHTML=D.tabTip;},scope:this}});if(!this.itemTpl){var C=new Ext.Template('<li class="{cls}" id="{id}">','<a onclick="return false;" class="x-grouptabs-text {iconCls}">{text}</a>',"</li>");C.disableFormats=true;C.compile();Ext.ux.GroupTab.prototype.itemTpl=C;}this.items.each(this.initTab,this);},afterRender:function(){Ext.ux.GroupTab.superclass.afterRender.call(this);if(this.activeTab!==undefined){var A=(typeof this.activeTab=="object")?this.activeTab:this.items.get(this.activeTab);delete this.activeTab;this.setActiveTab(A);}},initTab:function(C,A){var D=this.strip.dom.childNodes[A];var E=Ext.TabPanel.prototype.getTemplateArgs.call(this,C);if(C===this.mainItem){C.tabEl=this.groupEl;E.cls+=" x-grouptabs-main-item";}var B=D?this.itemTpl.insertBefore(D,E):this.itemTpl.append(this.strip,E);C.tabEl=C.tabEl||B;C.on("disable",this.onItemDisabled,this);C.on("enable",this.onItemEnabled,this);C.on("titlechange",this.onItemTitleChanged,this);C.on("iconchange",this.onItemIconChanged,this);C.on("beforeshow",this.onBeforeShowItem,this);},setMainItem:function(A){A=this.getComponent(A);if(!A||this.fireEvent("changemainitem",this,A,this.mainItem)===false){return ;}this.mainItem=A;},getMainItem:function(){return this.mainItem||null;},onBeforeShowItem:function(A){if(A!=this.activeTab){this.setActiveTab(A);return false;}},onAdd:function(A,C,B){if(this.rendered){this.initTab.call(this,C,B);}},onRemove:function(C,B){Ext.destroy(Ext.get(this.getTabEl(B)));this.stack.remove(B);B.un("disable",this.onItemDisabled,this);B.un("enable",this.onItemEnabled,this);B.un("titlechange",this.onItemTitleChanged,this);B.un("iconchange",this.onItemIconChanged,this);B.un("beforeshow",this.onBeforeShowItem,this);if(B==this.activeTab){var A=this.stack.next();if(A){this.setActiveTab(A);}else{if(this.items.getCount()>0){this.setActiveTab(0);}else{this.activeTab=null;}}}},onBeforeAdd:function(B){var A=B.events?(this.items.containsKey(B.getItemId())?B:null):this.items.get(B);if(A){this.setActiveTab(B);return false;}Ext.TabPanel.superclass.onBeforeAdd.apply(this,arguments);var C=B.elements;B.elements=C?C.replace(",header",""):C;B.border=(B.border===true);},onItemDisabled:Ext.TabPanel.prototype.onItemDisabled,onItemEnabled:Ext.TabPanel.prototype.onItemEnabled,onItemTitleChanged:function(B){var A=this.getTabEl(B);if(A){Ext.fly(A).child("a.x-grouptabs-text",true).innerHTML=B.title;}},onItemIconChanged:function(D,A,C){var B=this.getTabEl(D);if(B){Ext.fly(B).child("a.x-grouptabs-text").replaceClass(C,A);}},beforeDestroy:function(){Ext.TabPanel.prototype.beforeDestroy.call(this);this.tooltip.destroy();}});Ext.reg("grouptab",Ext.ux.GroupTab);