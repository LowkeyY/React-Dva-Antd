Ext.ns("lib.spinner");lib.spinner.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:false,constructor:function(A){lib.spinner.Spinner.superclass.constructor.call(this,A);Ext.apply(this,A);this.mimicing=false;},init:function(A){this.field=A;A.afterMethod("onRender",this.doRender,this);A.afterMethod("onEnable",this.doEnable,this);A.afterMethod("onDisable",this.doDisable,this);A.afterMethod("afterRender",this.doAfterRender,this);A.afterMethod("onResize",this.doResize,this);A.afterMethod("onFocus",this.doFocus,this);A.beforeMethod("onDestroy",this.doDestroy,this);},doRender:function(B,A){var C=this.el=this.field.getEl();var D=this.field;if(!D.wrap){D.wrap=this.wrap=C.wrap({cls:"x-form-field-wrap"});}else{this.wrap=D.wrap.addClass("x-form-field-wrap");}this.trigger=this.wrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});if(!D.width){this.wrap.setWidth(C.getWidth()+this.trigger.getWidth());}this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});this.splitter.setRight((Ext.isIE)?1:2).setTop(10).show();this.proxy=this.trigger.createProxy("",this.splitter,true);this.proxy.addClass("x-form-spinner-proxy");this.proxy.setStyle("left","0px");this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});this.initTrigger();this.initSpinner();},doAfterRender:function(){var A;if(Ext.isIE&&this.el.getY()!=(A=this.trigger.getY())){this.el.position();this.el.setY(A);}},doEnable:function(){if(this.wrap){this.disabled=false;this.wrap.removeClass(this.field.disabledClass);}},doDisable:function(){if(this.wrap){this.disabled=true;this.wrap.addClass(this.field.disabledClass);this.el.removeClass(this.field.disabledClass);}},doResize:function(A,B){if(typeof A=="number"){this.el.setWidth(A-this.trigger.getWidth());}this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth());},doFocus:function(){if(!this.mimicing){this.wrap.addClass("x-trigger-wrap-focus");this.mimicing=true;Ext.get(Ext.isIE?document.body:document).on("mousedown",this.mimicBlur,this,{delay:10});this.el.on("keydown",this.checkTab,this);}},checkTab:function(A){if(A.getKey()==A.TAB){this.triggerBlur();}},mimicBlur:function(A){if(!this.wrap.contains(A.target)&&this.field.validateBlur(A)){this.triggerBlur();}},triggerBlur:function(){this.mimicing=false;Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this);this.el.un("keydown",this.checkTab,this);this.field.beforeBlur();this.wrap.removeClass("x-trigger-wrap-focus");this.field.onBlur.call(this.field);},initTrigger:function(){this.trigger.addClassOnOver("x-form-trigger-over");this.trigger.addClassOnClick("x-form-trigger-click");},initSpinner:function(){this.field.addEvents({spin:true,spinup:true,spindown:true});this.keyNav=new Ext.KeyNav(this.el,{up:function(A){A.preventDefault();this.onSpinUp();},down:function(A){A.preventDefault();this.onSpinDown();},pageUp:function(A){A.preventDefault();this.onSpinUpAlternate();},pageDown:function(A){A.preventDefault();this.onSpinDownAlternate();},scope:this});this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate});this.field.mon(this.repeater,"click",this.onTriggerClick,this,{preventDefault:true});this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:true});this.field.mon(this.wrap,"mousewheel",this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this);},onMouseOver:function(){if(this.disabled){return ;}var A=this.getMiddle();this.tmpHoverClass=(Ext.EventObject.getPageY()<A)?"x-form-spinner-overup":"x-form-spinner-overdown";this.trigger.addClass(this.tmpHoverClass);},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass);},onMouseMove:function(){if(this.disabled){return ;}var A=this.getMiddle();if(((Ext.EventObject.getPageY()>A)&&this.tmpHoverClass=="x-form-spinner-overup")||((Ext.EventObject.getPageY()<A)&&this.tmpHoverClass=="x-form-spinner-overdown")){}},onMouseDown:function(){if(this.disabled){return ;}var A=this.getMiddle();this.tmpClickClass=(Ext.EventObject.getPageY()<A)?"x-form-spinner-clickup":"x-form-spinner-clickdown";this.trigger.addClass(this.tmpClickClass);},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass);},onTriggerClick:function(){if(this.disabled||this.el.dom.readOnly){return ;}var B=this.getMiddle();var A=(Ext.EventObject.getPageY()<B)?"Up":"Down";this["onSpin"+A]();},getMiddle:function(){var B=this.trigger.getTop();var C=this.trigger.getHeight();var A=B+(C/2);return A;},isSpinnable:function(){if(this.disabled||this.el.dom.readOnly){Ext.EventObject.preventDefault();return false;}return true;},handleMouseWheel:function(A){if(this.wrap.hasClass("x-trigger-wrap-focus")==false){return ;}var B=A.getWheelDelta();if(B>0){this.onSpinUp();A.stopEvent();}else{if(B<0){this.onSpinDown();A.stopEvent();}}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop();},endDrag:function(){this.proxy.hide();},onDrag:function(){if(this.disabled){return ;}var B=Ext.fly(this.dd.getDragEl()).getTop();var A="";if(this._previousY>B){A="Up";}if(this._previousY<B){A="Down";}if(A!=""){this["onSpin"+A]();}this._previousY=B;},onSpinUp:function(){if(this.isSpinnable()==false){return ;}if(Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();return ;}else{this.spin(false,false);}this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this);},onSpinDown:function(){if(this.isSpinnable()==false){return ;}if(Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();return ;}else{this.spin(true,false);}this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this);},onSpinUpAlternate:function(){if(this.isSpinnable()==false){return ;}this.spin(false,true);this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this);},onSpinDownAlternate:function(){if(this.isSpinnable()==false){return ;}this.spin(true,true);this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this);},spin:function(D,B){var A=parseFloat(this.field.getValue());var C=(B==true)?this.alternateIncrementValue:this.incrementValue;(D==true)?A-=C:A+=C;A=(isNaN(A))?this.defaultValue:A;A=this.fixBoundries(A);this.field.setRawValue(A);},fixBoundries:function(B){var A=B;if(this.field.minValue!=undefined&&A<this.field.minValue){A=this.field.minValue;}if(this.field.maxValue!=undefined&&A>this.field.maxValue){A=this.field.maxValue;}return this.fixPrecision(A);},fixPrecision:function(B){var A=isNaN(B);if(!this.field.allowDecimals||this.field.decimalPrecision==-1||A||!B){return A?"":B;}return parseFloat(parseFloat(B).toFixed(this.field.decimalPrecision));},doDestroy:function(){if(this.trigger){this.trigger.remove();}if(this.wrap){this.wrap.remove();delete this.field.wrap;}if(this.splitter){this.splitter.remove();}if(this.dd){this.dd.unreg();this.dd=null;}if(this.proxy){this.proxy.remove();}if(this.repeater){this.repeater.purgeListeners();}if(this.mimicing){Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this);}}});Ext.form.Spinner=lib.spinner.Spinner;