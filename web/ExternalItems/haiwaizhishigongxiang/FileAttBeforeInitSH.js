Ext.ns("ExternalItems.haiwaizhishigongxiang");ExternalItems.haiwaizhishigongxiang.FileAttBeforeInitSH=function(mySelfConfig,json,param,parentPanel){if(mySelfConfig.loadResult){mySelfConfig.loadResult=mySelfConfig.loadResult.createInterceptor(function(result){if(Ext.isObject(result.data)){this.defualtLoadData=Ext.apply({},result.data);for(var att in this.columnBeforeRelations){this.formatDataValue(result.data,att);}if(result.data.FILE_CLASS){this.changeFiledVisible(result.data.FILE_CLASS.value);}if(filedDefualtValue=(this.defualtLoadData&&this.defualtLoadData.SPACE_ID)){this.hiddenFieldNodeId(filedDefualtValue);}}});}else{mySelfConfig.defualtLoadData=Ext.apply({},json.data);}mySelfConfig.formatDataValue=function(obj,key){var value=obj[key];if(value&&Ext.isString(value)&&value.indexOf("::")>-1){obj[key]={value:value,text:value.split("::")[1]};}};mySelfConfig.buttons=json.buttonArray;var beforeRelations={},afterRelations={},relationTables={};if(json.relationShowFiled){Ext.apply((mySelfConfig.relationShowFiled={}),json.relationShowFiled);delete json.relationShowFiled;}if(json.relationChangeFiled){Ext.apply(beforeRelations,json.relationChangeFiled);delete json.relationChangeFiled;}for(var att in beforeRelations){var key=beforeRelations[att];if(afterRelations[key]){afterRelations[key].push(att);}else{afterRelations[key]=[att];}}mySelfConfig.columnBeforeRelations={};mySelfConfig.getStringValue=function(value){return Ext.isObject(value)?value.value:value;};mySelfConfig.changeCountryAllowBlank=function(){var country=this.form.findField("COUNTRY_ID"),fileclass,region;if(country&&(fileclass=this.form.findField("FILE_CLASS"))&&(region=this.form.findField("REGION_ID"))){if(!country.old_fieldLabel){country.old_fieldLabel=country.fieldLabel;}var allowBlank=true,fileds,value;if((fileds=this.relationShowFiled[fileclass.getValue()||this.getStringValue(this.defualtLoadData[fileclass.name])])&&fileds[country.name]){allowBlank=(region.getValue()||(this.defualtLoadData&&this.getStringValue(this.defualtLoadData[region.name])))=="0::全球";}country.allowBlank=allowBlank;country.label&&(country.label.dom.innerHTML=(country.old_fieldLabel+(!allowBlank?'<font color="red">*</font>:':":")));}};mySelfConfig.changeFiledVisible=function(key){var visible;if(this.relationShowFiled&&(visible=this.relationShowFiled[key])){this.changeCountryAllowBlank();this.cascade(function(item){if(/^att_(\d+)$/ig.test(item.name)||item.name=="IS_RESULT"){item.setVisible(visible[item.name]);item.setDisabled(!visible[item.name]);}});}};mySelfConfig.hiddenFieldNodeId=function(value){var field=this.form.findField("NODE_ID"),fieldC;if(field&&value){field.setReadOnly(this.getStringValue(value)=="8afaec81-53efdc82-0153-efdc829f-0000");this.changeValueNodeId();}};mySelfConfig.changeValueNodeId=function(){var field=this.form.findField("NODE_ID"),fieldC,node;if(field&&field.readOnly&&(fieldC=this.form.findField("COUNTRY_ID"))&&fieldC.menuTree&&(node=fieldC.menuTree.getNowNode())){field.setValue({text:fieldC.getText(),value:fieldC.getValue()});var path="",counts=0;while(node&&node.prop._id!="top"){if(counts>50){break;}path="/"+node.prop.title+path;node=node.parent;counts++;}if(!Ext.isEmpty(path)){var text="";if((fieldC=this.form.findField("SPACE_ID"))&&fieldC.getText()){text="/"+fieldC.getText();}field.el.dom.value=text+path;}}};mySelfConfig.resetNodeField=function(){var field;if((field=this.form.findField("NODE_ID"))){var value=this.form.findField("SPACE_ID").getValue();if(value==undefined||value==""){Ext.msg("warn","所属空间丢失，请刷新页面重试。");return ;}if(field.view){field.view.root.eachChild(function(node){if(node.attributes.relationId!=value){node.getUI().hide();}else{node.getUI().show();}});field.restrictHeight();}}};mySelfConfig.TypeClick=function(){var classValue=this.form.findField("COUNTRY_ID").getValue();var type=this.form.findField("ATT_1");if(classValue=="ac886ab6-1cf8-4ede-bc2f-633083f0ed0a"){type.show();type.store=new Ext.data.SimpleStore({id:0,fields:["value","text"],data:[[1,"省委文件"],[2,"其他部门起草的省政府文件"],[3,"办公厅起草的省政府文件"]]});}else{if(classValue=="e1c54e40-8d7d-4d60-a0b1-73fac2308f23"||classValue=="ae3345f7-a7c3-47ce-90e0-8aa7f4547228"||classValue=="ad4886bb-aeec-4d81-98bd-a30f4a661743"||classValue=="fc341da5-9d83-4ec9-9d92-ba615cecca7c"||classValue=="45880cb3-5daf-44b6-b4dd-3161d9edb66a"||classValue=="e49a4dd4-6f5f-432f-bf3c-b95285abc9c6"||classValue=="e5da7005-7b71-4b1c-8410-e98a5e8507c9"){type.show();type.store=new Ext.data.SimpleStore({id:0,fields:["value","text"],data:[[4,"省政府领导的综合性讲话"],[5,"部门起草的讲话"]]});}else{if(classValue=="6d0c9c91-693e-4628-95cf-87d17bc9121e"||classValue=="5be8a4f9-51c1-461d-8845-a3a8e56ef930"){type.show();type.store=new Ext.data.SimpleStore({id:0,fields:["text","value"],data:[["转载文件",6],["原创文件",7]]});}else{type.hide();type.setValue("","");}}}};var packingChild22=function(c){var isNode=(c.name=="NODE_ID");c.loader=new Ext.tree.TreeLoader({url:"/ExternalItems/haiwaizhishigongxiang/UpFileGetNode.jcp",method:"Post",baseParams:{types:c.name}});var rootNode=new Ext.tree.AsyncTreeNode(Ext.apply({text:"root",id:"root",panelId:mySelfConfig.id},!isNode?{}:{listeners:{expand:function(node){var p;if(p=Ext.getCmp(node.attributes.panelId)){p.resetNodeField();}}}}));Ext.apply(c,{editable:false,rootVisible:false,panelId:mySelfConfig.id,mode:"local",treeConfig:{rootVisible:false,panelId:mySelfConfig.id},root:rootNode});};var pageEdit=param.pageType==="edit",currentData=Ext.apply({},json.data);var packingChild=function(c){c.store=new Ext.data.JsonStore(Ext.apply({url:"/ExternalItems/haiwaizhishigongxiang/propertyStoreGetData.jcp",root:"root",fields:["text","value"],method:"POST"},param.pageType==="edit"?{autoLoad:true,baseParams:{relationTable:c.relationTable,exportData:currentData[c.beforeRelation]||""}}:{autoLoad:true,baseParams:{relationTable:c.relationTable}}));Ext.apply(c,{hiddenName:c.name,displayField:"text",translateItems:true,valueField:"value",mode:"local",triggerAction:"all",selectOnFocus:true,listeners:{change:function(combo){if(this.afterRelation){var frm=this.findParentByType("form"),field;if(frm){frm.changeCountryAllowBlank();Ext.each(this.afterRelation,function(c){if(field=(frm.form.findField(c)||frm.form.findField(c.toUpperCase()))){field.setValue({text:"",value:""});field.getStore().load({params:{exportData:combo.getValue()}});}});}}},beforequery:function(){if(this.beforeRelation){var frm=this.findParentByType("form"),field;if(frm&&(field=frm.form.findField(this.beforeRelation))&&field.getValue()==""&&field.fieldLabel){field.onFocus({});Ext.msg("warn",'请先选择"'+field.fieldLabel+'"');return false;}}}}});};var fn=function(c){if(c.items){Ext.each(c.items,fn);}else{if(Ext.isDefined(afterRelations[c.name])){c.afterRelation=afterRelations[c.name];}if(Ext.isDefined(beforeRelations[c.name])){c.beforeRelation=beforeRelations[c.name];}if(Ext.isDefined(relationTables[c.name])){c.relationTable=relationTables[c.name];c.xtype="combo";packingChild(c);}if(/^att_(\d+)$/ig.test(c.name)&&c.name.toUpperCase()!="ATT_1"){c.hidden=true;if(json.filedConfigs&&json.filedConfigs[c.name]){Ext.apply(c,json.filedConfigs[c.name]);}if(c.xtype=="combo"){packingChild(c);}}if(c.name.toUpperCase()=="ATT_1"){c.reset=Ext.emptyFn;c.listeners={focus:function(combo,record,index){var frm=this.findParentByType("form");if(frm){frm.TypeClick();}}};}if(c.name.toUpperCase()=="FILE_CLASS"){c.reset=Ext.emptyFn;c.listeners={select:function(combo,record,index){var frm=this.findParentByType("form");if(frm){frm.changeFiledVisible(record.get("value"));}}};}if(c.name.toUpperCase()=="COUNTRY_ID"){c.reset=Ext.emptyFn;c.listeners={select:function(combo,record,index){var frm=this.findParentByType("form");if(frm){frm.changeValueNodeId();}}};}if(c.name.toUpperCase()=="IS_RESULT"){c.hidden=true;}if(c.name=="NODE_ID"){c.beforeRelation=true;c.oldType=c.xtype;c.xtype="combotree";packingChild22(c);c.listeners={select:function(combo,node,e){var path="",frm,field;do{path="/"+node.text+path;node=node.parentNode;}while(node&&!node.isRoot);if(!Ext.isEmpty(path)){this.el.dom.value=path;}},focus:function(combo,node,e){var frm;if(frm=combo.findParentByType("form")){frm.resetNodeField();}}};}if(c.xtype=="textarea"){c.height=80;if(c.onTransferToView&&Ext.isFunction(c.onTransferToView)){c.onTransferToView=c.onTransferToView.createSequence(function(c){c.height=44;});}}if(c.relationTable){mySelfConfig.columnBeforeRelations[c.name]=true;}}};Ext.each(json.model,fn);delete json.filedConfigs;};