Ext.namespace("utils.km.portal");utils.km.portal.TopPortalPanel=function(D,A,B,C){this.pageFrame=A;this.frames=D;this.params=C;this.fromType=B;this.ButtonArray=[];this.formDS=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"/utils/km/portal/create.jcp",method:"GET"}),reader:new Ext.data.JsonReader({},["id","portal_name","portal_pname","lang","current_stat","portal_desc","portal_id"]),remoteSort:false});this.langDs=new Ext.data.SimpleStore({fields:["langId","langTitle"],data:[["0","中文".loc()],["1","英文".loc()]]});this.currentStatDs=new Ext.data.SimpleStore({fields:["currentStat","currentStatName"],data:[["0","封存".loc()],["1","激活".loc()]]});this.ButtonArray.push(new Ext.Toolbar.Button({btnId:"topPortalSave",text:"保存".loc(),state:"create",icon:"/themes/icon/common/save.gif",cls:"x-btn-text-icon  bmenu",disabled:false,hidden:true,scope:this,handler:this.onButtonClick}));this.ButtonArray.push(new Ext.Toolbar.Button({btnId:"topPortalClear",text:"清空".loc(),state:"create",icon:"/themes/icon/xp/clear.gif",cls:"x-btn-text-icon  bmenu",state:"create",disabled:false,scope:this,hidden:true,handler:this.onButtonClick}));this.ButtonArray.push(new Ext.Toolbar.Button({btnId:"newNode",text:"新建节点".loc(),icon:"/themes/icon/xp/newfile.gif",cls:"x-btn-text-icon  bmenu",state:"edit",disabled:false,scope:this,hidden:true,handler:this.onButtonClick}));this.ButtonArray.push(new Ext.Toolbar.Button({btnId:"topPortalUpdatesave",text:"保存".loc(),icon:"/themes/icon/common/save.gif",cls:"x-btn-text-icon  bmenu",disabled:false,state:"edit",scope:this,hidden:true,handler:this.onButtonClick}));this.ButtonArray.push(new Ext.Toolbar.Button({btnId:"topPortalDelete",text:"删除".loc(),state:"edit",icon:"/themes/icon/common/delete.gif",cls:"x-btn-text-icon  bmenu",disabled:false,scope:this,hidden:true,handler:this.onButtonClick}));this.topPortalForm=new Ext.FormPanel({labelWidth:100,labelAlign:"right",id:"topPortalBase",cached:true,url:"/utils/km/portal/create.jcp",method:"POST",border:false,bodyStyle:"padding:20px 0px 0px 0px;background:#FFFFFF;",items:[{layout:"column",border:false,items:[{columnWidth:0.5,layout:"form",border:false,items:[new Ext.form.TextField({fieldLabel:"门户名称".loc(),name:"TopPortalName",width:150,maxLength:24,allowBlank:false,blankText:"门户名称必须提供.".loc(),maxLengthText:"门户名称不能超过{0}个字符!".loc()})]},{columnWidth:0.5,layout:"form",border:false,items:[new Ext.form.TextField({fieldLabel:"门户物理名称".loc(),name:"TopPortalPname",width:150,maxLength:24,allowBlank:false,blankText:"物理名称必须提供.".loc(),maxLengthText:"物理名称不能超过{0}个字符!".loc()})]}]},{layout:"column",border:false,items:[{columnWidth:0.5,layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:"语言".loc(),lazyRender:true,name:"lang",minLength:1,value:1,store:this.langDs,valueField:"langId",displayField:"langTitle",triggerAction:"all",mode:"local"})]},{columnWidth:0.5,layout:"form",border:false,items:[new Ext.form.ComboBox({fieldLabel:"当前状态".loc(),lazyRender:true,name:"currentStat",minLength:1,value:1,store:this.currentStatDs,valueField:"currentStat",displayField:"currentStatName",triggerAction:"all",mode:"local"})]}]},{layout:"column",border:false,items:[{columnWidth:1,layout:"form",border:false,items:[new Ext.form.TextArea({fieldLabel:"系统说明".loc(),name:"PortalDesc",width:550,height:60,maxLength:500,maxLengthText:"系统说明不能超过{0}个字符!".loc()})]}]}],tbar:this.ButtonArray});this.MainTabPanel=this.topPortalForm;};utils.km.portal.TopPortalPanel.prototype={formCreate:function(A){this.params=A;if(this.MainTabPanel.rendered){this.toggleToolBar("create");this.pageFrame.mainPanel.setStatusValue(["门户管理".loc()]);this.topPortalForm.form.reset();}},formEdit:function(){this.toggleToolBar("edit");},loadData:function(A){this.formDS.baseParams=A;this.formDS.on("load",this.renderForm,this);this.formDS.load({params:{start:0,limit:1}});},toggleToolBar:function(B){var A=this.topPortalForm.getTopToolbar();A.items.each(function(C){C.hide();},A.items);A.items.each(function(C){if(C.state==B){C.show();}},A.items);},renderForm:function(){var C=this.formDS.getAt(0).data;for(var A=0;A<this.ButtonArray.length;A++){if(this.ButtonArray[A].btnId=="topPortalDelete"){this.ButtonArray[A].setDisabled(C.son!="0");}else{if(this.ButtonArray[A].btnId=="newNode"){this.ButtonArray[A].setDisabled(this.fromType=="portal");}else{if(this.ButtonArray[A].btnId=="topPortalNew"){if(C.parent_top!="0"){this.ButtonArray[A].setDisabled(true);}else{this.ButtonArray[A].setDisabled(false);}}}}}this.params.parent_id=this.params.id=C.id;var B=this.topPortalForm.form;B.findField("TopPortalName").setValue(C.portal_name);B.findField("TopPortalPname").setValue(C.portal_pname);B.findField("lang").setValue(C.lang);B.findField("currentStat").setValue(C.current_stat);B.findField("PortalDesc").setValue(C.portal_desc);this.params.portal_id=C.portal_id;this.pageFrame.mainPanel.setStatusValue(["门户管理".loc(),C.id,"无".loc(),"无".loc()]);},onButtonClick:function(C){var D=this.topPortalForm.form;if(C.btnId=="topPortalNew"){this.params.parent_top=this.params.parent_id;this.formCreate(this.params);}else{if(C.btnId=="newNode"){using("utils.km.portal.PortalPanel");var B=this.frames.get("Portal");B.menu=new utils.km.portal.PortalPanel(this.frames,B);B.mainPanel.add(B.menu.MainTabPanel);B.mainPanel.setActiveTab(B.menu.MainTabPanel);B.menu.formCreate(this.formDS.baseParams);}else{if(C.btnId=="topPortalSave"){if(D.isValid()){var A=this.params;A.type="save";A.lang=this.topPortalForm.form.findField("lang").getValue();A.currentStat=this.topPortalForm.form.findField("currentStat").getValue();D.submit({url:"/utils/km/portal/create.jcp",params:A,method:"POST",scope:this,success:function(F,G){Ext.msg("info","保存成功!".loc());this.pageFrame.navPanel.getTree().loadSubNode(G.result.id,this.frames.get("clickEvent"));},failure:function(F,G){Ext.msg("error","数据提交失败,原因:".loc()+"<br>"+G.result.message);}});}else{Ext.msg("error","数据不能提交,请修改表单中标识的错误!".loc());}}else{if(C.btnId=="topPortalClear"){this.topPortalForm.form.reset();}else{if(C.btnId=="update"){this.formEdit();}else{if(C.btnId=="topPortalDelete"){Ext.msg("confirm","确认删除?".loc(),function(F){if(F=="yes"){var G=this.params;G.type="delete";this.topPortalForm.form.submit({url:"/utils/km/portal/create.jcp",params:G,method:"post",scope:this,success:function(H,I){this.pageFrame.navPanel.getTree().loadParentNode(this.frames.get("clickEvent"));},failure:function(H,I){Ext.msg("error","数据删除失败!,原因:".loc()+"<br>"+I.result.message);}});}}.createDelegate(this));}else{if(C.btnId=="topPortalUpdatesave"){if(D.isValid()){var E=this.params;E.type="updatesave";E.lang=this.topPortalForm.form.findField("lang").getValue();E.currentStat=this.topPortalForm.form.findField("currentStat").getValue();D.submit({url:"/utils/km/portal/create.jcp",params:E,method:"post",scope:this,success:function(F,G){Ext.msg("info","更新成功!".loc());this.pageFrame.navPanel.getTree().loadSelfNode(G.result.id,this.frames.get("clickEvent"));},failure:function(F,G){Ext.msg("error","数据提交失败,原因:".loc()+"<br>"+G.result.message);}});}else{Ext.msg("error","数据不能提交,请修改表单中标识的错误!".loc());}}}}}}}}}};