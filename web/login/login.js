Ext.SSL_SECURE_URL="/Ext/resources/images/default/s.gif";Ext.BLANK_IMAGE_URL="/Ext/resources/images/default/s.gif";Login=function(){var A,B,C="login.jcp";return{Init:function(){var D=new Ext.data.Connection();var E=get_cookie("locale");D.request({method:"GET",url:"/login/getSysConf.jcp?lang="+E+"&ra="+Math.random()});D.on("requestcomplete",function(J,I){var L=Ext.decode(I.responseText);var Q=L.title;var K=L.logo;var P=L.authType;var M=L.lt;window.document.title=Q;var N=Login.getBackgroundIndex();Ext.getBody().setStyle("background","url(./desktop-"+(N)+".jpg)");if(Ext.isDefined(L.lang)){var G=L.lang;var F=K.split(".");K=F[0]+"_"+G.currentLanguage+"."+F[1];}Ext.QuickTips.init();var O=new Ext.Panel({baseCls:"x-plain",style:"background:#f9f9f9 url("+K+") no-repeat center center;",region:"center"});if(Ext.isDefined(L.lang)){var G=L.lang;var S=L.lang.languages;using("lang."+(G.needToTranslate?G.currentLanguage:"dumb"));store=new Ext.data.JsonStore({autoDestroy:true,root:"languages",fields:["text","value","country"],data:G});store.each(function(T){T.set("country",T.get("value").substring(3,5));});langType=new Ext.form.ComboBox({fieldLabel:"选择语言".loc(),autoWidth:true,allowBlank:true,typeAhead:false,tpl:'<tpl for="."><div class="x-combo-list-item"><img src="/themes/icon/nationalflag/{country}.jpg" style="margin-right:5px;">{text}</div></tpl>',editable:false,width:240,store:store,hiddenName:"usrLang",valueField:"value",displayField:"text",triggerAction:"all",restrictHeight:function(){this.innerList.dom.style.height="";var U=this.innerList.dom,X=this.list.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,V=Math.max(U.clientHeight,U.offsetHeight,U.scrollHeight),T=this.getPosition()[1]-Ext.getBody().getScroll().top,Y=Ext.lib.Dom.getViewHeight()-T-this.getSize().height,W=Math.max(T,Y,this.minHeight||0)-this.list.shadowOffset-X-5;V=Math.min(V,W,this.maxHeight)+this.store.getCount()*2;this.innerList.setHeight(V);this.list.beginUpdate();this.list.setHeight(V+X);this.list.alignTo.apply(this.list,[this.el].concat(this.listAlign));this.list.endUpdate();},value:G.currentLanguage,mode:"local"});langType.on("select",function(U,V){var T=V.get("value");set_cookie("locale",T,100,"/");set_cookie("localeSelect",T,100,"/");self.location.replace("/login");});}else{using("lang.dumb");langType={xtype:"hidden"};}var H=new Ext.form.FormPanel({baseCls:"x-plain",baseParams:{module:"login"},defaults:{width:200},defaultType:"textfield",frame:false,height:90,id:"login-form",items:[{fieldLabel:"用户名".loc(),name:"usrMail",id:"username",style:"ime-mode:disabled;"},{fieldLabel:"密码".loc(),xtype:"passwordfield",showCapsWarning:true,showStrengthMeter:false,name:"usrPwd1"},langType,{inputType:"hidden",name:"usrPwd"},{inputType:"hidden",name:"lt",value:M}],labelWidth:120,region:"south",url:C});var R=function(){var U=B.findField("usrPwd1");var T=U.getValue();if(P=="simple"){B.findField("usrPwd").setValue(T);}else{U.setValue("");B.findField("usrPwd").setValue(hex_md5(T));}B.submit({waitMsg:"请等待".loc(),reset:true,waitTitle:"正在登录当前系统".loc(),success:Login.Success,scope:Login,failure:function(W,V){U.setValue(T);Ext.Msg.alert("登录失败".loc(),V.result.errors[0].msg);}});};A=new Ext.Window({buttons:[{handler:R,scope:Login,text:"登录".loc()}],buttonAlign:"right",closable:false,draggable:true,height:250,id:"login-win",layout:"border",minHeight:250,minWidth:530,plain:false,resizable:true,constrainHeader:true,items:[O,H],title:"登录".loc(),width:530});B=H.getForm();A.show();A.getEl().addKeyListener(13,R);Ext.EventManager.onWindowResize(function(){A.center();},this);},this);},Success:function(E,D){if(D&&D.result){A.destroy(true);var F="/index.jcp";window.location=F;}},getBackgroundIndex:function(){var G=1,F=2,D="Login_bg_img_num",E=get_cookie(D);E=!E||(E>=F)?G:E++;set_cookie(D,E);return get_cookie(D);}};}();Ext.form.BasicForm.prototype.afterAction=function(A,C){this.activeAction=null;var B=A.options;if(B.waitMsg){Ext.MessageBox.updateProgress(1);Ext.MessageBox.hide();}if(C){if(B.reset){this.reset();}Ext.callback(B.success,B.scope,[this,A]);this.fireEvent("actioncompleted",this,A);}else{Ext.callback(B.failure,B.scope,[this,A]);this.fireEvent("actionfailed",this,A);}};Ext.onReady(Login.Init,Login,true);