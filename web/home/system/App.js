Ext.app.App=function(A){Ext.apply(this,A);this.addEvents({ready:true,beforeunload:true,moduleactioncomplete:true});Ext.onReady(this.initApp,this);};Ext.extend(Ext.app.App,Ext.util.Observable,{isReady:false,launchers:null,modules:null,styles:null,startConfig:null,startItemsConfig:null,logoutButtonConfig:null,connection:"system/setup.jcp",requestQueue:[],init:Ext.emptyFn,startMenuSortFn:Ext.emptyFn,getModules:Ext.emptyFn,getLaunchers:Ext.emptyFn,getStyles:Ext.emtpyFn,getStartConfig:Ext.emptyFn,getLogoutConfig:Ext.emptyFn,initApp:function(){this.init();this.preventBackspace();this.modules=this.modules||this.getModules();if(this.modules){this.initDesktopConfig();}this.startConfig=this.startConfig||this.getStartConfig();this.startItemsConfig=this.startItemsConfig||this.getStartItemsConfig();Ext.apply(this.startConfig,this.startItemsConfig);this.desktop=new Ext.Desktop(this);this.desktop.taskbar.startMenu.addTool({text:"锁定屏幕".loc(),icon:"/themes/icon/xp/lock_folder.gif",handler:function(){Ext.Ajax.request({url:"/login/logout.jcp",method:"GET"});top.TimeOut.showWindow();},scope:this});this.logoutConfig=this.logoutConfig||this.getLogoutConfig();this.initLogout();Ext.EventManager.on(window,"beforeunload",this.onBeforeUnload,this);this.fireEvent("ready",this);this.isReady=true;},initDesktopConfig:function(A){if(!A){this.getDesktopConfig();}else{this.startManu=this.desktop.taskbar.startMenu;if(this.modules){this.initModules(this.modules);}this.desktop.config=A;this.desktop.initialConfig=A;A.styles=A.styles||[];this.initStyles(A.styles);A.contextmenu=A.contextmenu||[];A.quickstart=A.quickstart||[];A.shortcut=A.shortcut||[];A.autorun=A.autorun||[];this.initContextMenu(A.contextmenu);this.initQuickStart(A.quickstart);this.initShortcut(A.shortcuts);this.initAutoRun(A.autorun);}},initLogout:function(){if(this.logoutConfig){this.desktop.taskbar.startMenu.addTool(this.logoutConfig);}},initStyles:function(A){this.styles=A;var B=this.desktop;B.setBackgroundColor(A.backgroundcolor);B.setFontColor(A.fontcolor);B.setTheme(A.theme);B.setTransparency(A.transparency);B.setWallpaper(A.wallpaper);B.setWallpaperPosition(A.wallpaperposition);return true;},initModules:function(B){for(var C=0,A=B.length;C<A;C++){if(B[C].moduleType=="Application"&&(!Ext.isDefined(B[C].launcher.startmenuShow)||B[C].launcher.startmenuShow===true)){this.startManu.add(B[C].launcher);}B[C].app=this;}},initAutoRun:function(mIds){if(mIds){for(var i=0,len=mIds.length;i<len;i++){var m=this.getModule(mIds[i]);if(m){m.autorun=true;m.launcher.desktop=this.desktop;if(m.launcher.openType==="false"){window.open(m.launcher.url);}else{if(m.launcher.isIFrame=="true"){var bsNode=new WorkBench.baseNode();bsNode.init(m.launcher);}else{var lib=m.launcher.url;if(Ext.isDefined(lib)&&lib!=""){var paramArray=m.launcher.url.split("?");var param=(paramArray.length>1)?Ext.urlDecode(paramArray[1]):{};param.objectId=param.parent_id;Ext.apply(m.launcher,param);using(paramArray[0]);var processModule=null;processModule=eval("new "+paramArray[0]+"()");setTimeout(function(){processModule.init(m.launcher,param);},1000);}}}}}}},initContextMenu:function(C){if(C){for(var B=0,A=C.length;B<A;B++){this.desktop.addContextMenuItem(C[B]);}}},initShortcut:function(C){if(C){for(var B=0,A=C.length;B<A;B++){this.desktop.addShortcut(C[B],false);}}},initQuickStart:function(C){if(C){for(var B=0,A=C.length;B<A;B++){this.desktop.addQuickStartButton(C[B],false);}}},getStartItemsConfig:function(){},createWindow:function(B){var A=this.requestModule(B,function(C){if(C){C.createWindow();}},this);},requestModule:function(C,B,D){var A=this.getModule(C);if(A){if(A.loaded===true){B.call(D,A);}else{if(B&&D){this.requestQueue.push({id:A.id,callback:B,scope:D});this.loadModule(A);}}}},loadModule:function(m){if(m.isLoading){return false;}var id=m.id;var moduleName=m.launcher.text;var notifyWin=this.desktop.showNotification({html:"载入中".loc()+moduleName+"...",title:"请等待".loc()});m.isLoading=true;Ext.Ajax.request({url:this.connection,params:{service:"load",moduleId:id},success:function(o){notifyWin.setIconClass("x-icon-done");notifyWin.setTitle("完成".loc());notifyWin.setMessage(moduleName+"载入完成.".loc());this.desktop.hideNotification(notifyWin);notifyWin=null;if(o.responseText!==""){eval(o.responseText);this.loadModuleComplete(true,id);}else{alert("An error occured on the server.");}},failure:function(){alert("Connection to the server failed!");},scope:this});return true;},loadModuleComplete:function(G,H){if(G===true&&H){var B=this.createModule(H);if(B){B.isLoading=false;B.loaded=true;B.init();B.on("actioncomplete",this.onModuleActionComplete,this);var F=this.requestQueue;var E=[];var D=false;for(var C=0,A=F.length;C<A;C++){if(D===false&&F[C].id===H){D=F[C];}else{E.push(F[C]);}}this.requestQueue=E;if(D){D.callback.call(D.scope,B);}}}},createModule:function(id){var p=this.getModule(id);if(p&&p.loaded===false){if(eval("typeof "+p.className)==="function"){var m=eval("new "+p.className+"()");m.app=this;var ms=this.modules;for(var i=0,len=ms.length;i<len;i++){if(ms[i].id===m.id){Ext.apply(m,ms[i]);ms[i]=m;}}return m;}}return null;},getModule:function(B){var C=this.modules;for(var D=0,A=C.length;D<A;D++){if(C[D].moduleId==B||C[D].moduleType==B){return C[D];}}return null;},registerModule:function(A){if(!A){return false;}this.modules.push(A);A.launcher.handler=this.createWindow.createDelegate(this,[A.id]);A.app=this;return true;},makeRequest:function(C,B){if(C!==""&&B){var A=this.requestModule(C,function(D){if(D){D.handleRequest(B);}},this);}},getDesktop:function(){return this.desktop;},onReady:function(B,A){if(!this.isReady){this.on("ready",B,A);}else{B.call(A,this);}},onBeforeUnload:function(A){if(this.fireEvent("beforeunload",this)===false){A.stopEvent();}},preventBackspace:function(){var A=new Ext.KeyMap(document,[{key:Ext.EventObject.BACKSPACE,stopEvent:false,fn:function(C,D){var B=D.target.tagName;if(B!="INPUT"&&B!="TEXTAREA"){D.stopEvent();}}}]);},onModuleActionComplete:function(B,C,A){this.fireEvent("moduleactioncomplete",this,B,C,A);}});Ext.layout.ContainerLayout.prototype.fieldTpl=(function(){var A=new Ext.Template('<div class="x-form-item {itemCls}" style="{itemStyle}" tabIndex="-1">','<label for="{id}" style="{labelStyle}" class="x-form-item-label {labelCls}">{label}{labelSeparator}</label>','<div class="x-form-element" id="x-form-el-{id}" style="{elementStyle}">','</div><div class="{clearCls}"></div>',"</div>");A.disableFormats=true;return A.compile();})();Ext.layout.FormLayout.prototype.getTemplateArgs=function(B){var A=!B.fieldLabel||B.hideLabel;return{id:B.id,label:B.fieldLabel,labelCls:B.labelCls||this.labelCls||"",labelStyle:B.labelStyle||this.labelStyle||"",elementStyle:B.elementStyle||this.elementStyle||"",labelSeparator:A?"":(typeof B.labelSeparator=="undefined"?this.labelSeparator:B.labelSeparator),itemStyle:(B.itemStyle||this.container.itemStyle||""),itemCls:(B.itemCls||this.container.itemCls||"")+(B.hideLabel?" x-hide-label":""),clearCls:B.clearCls||"x-form-clear-left"};};Ext.Resizable.prototype.resizeElement=function(){var A=this.proxy.getBox();if(!this.east&&!this.west){A.width=this.el.getStyle("width");}if(!this.north&&!this.south){A.height=this.el.getStyle("height");}if(this.updateBox){this.el.setBox(A,false,this.animate,this.duration,null,this.easing);}else{this.el.setSize(A.width,A.height,this.animate,this.duration,null,this.easing);}this.updateChildSize();if(!this.dynamic){this.proxy.hide();}return A;};