var WorkBench=WorkBench||{};WorkBench.len=0;WorkBench.modules=[];WorkBench.language="cn";WorkBench.date_format="Y-m-d";WorkBench.timezone="Asia/Shanghai";WorkBench.date_seperator="/";WorkBench.time_format="G:i";WorkBench.first_weekday="1";WorkBench.thousands_seperator=",";WorkBench.decimal_seperator=".";WorkBench.currency="￥";WorkBench.unit="metric";WorkBench.potal_user_token="";WorkBench.menuHeight=150;WorkBench.con=new Ext.data.Connection();WorkBench.connectionConfig={method:"GET",url:"/home/system/getmenu.jcp?rand="+Math.random()};WorkBench.con.request(WorkBench.connectionConfig);WorkBench.con.on("requestcomplete",function(E,n){var N=Ext.decode(n.responseText);if(Ext.isDefined(N.userToken)){WorkBench.potal_user_token=N.userToken;}var c=N.menu;Ext.i18n.apply(N);WorkBench.len=c.length;if(WorkBench.len<6){WorkBench.menuHeight=148;}else{if(WorkBench.len<12){if(Ext.isIE){WorkBench.menuHeight=28*WorkBench.len;}else{WorkBench.menuHeight=29*WorkBench.len;}}else{if(Ext.isIE){WorkBench.menuHeight=26*WorkBench.len;}else{WorkBench.menuHeight=27*WorkBench.len;}}}function B(i){return(i.sys_version&&i.sys_app_id);}function f(s,i,j){if(s===true&&j){var t=Ext.lib.Dom.getViewWidth()-j-i;return t<=0?i:t;}return i;}function O(i){if(B(i)){return{x:f(i.default_postion==="false",(i.default_x||0),(i.default_width||0)),y:i.default_y||0,winWidth:i.default_width||0,winHeight:i.default_height||0,winDraggable:i.default_win_postion==="true",winResizable:i.default_win_size==="true"};}return{x:i.x||0,y:i.y||0,winWidth:i.width||0,winHeight:i.height||0,winDraggable:false,winResizable:true};}function X(i){if(i&&/^((https|http|ftp|rtsp|mms)?:\/\/)/i.test(i)){return"true";}return"false";}function g(i){if(B(i)){return Ext.apply({appid:i.sys_app_id,apptoken:i.default_token},P());}return{};}function P(){var j={},i=WorkBench.potal_user_token;if(i&&(i=i.split("::")).length>1){j.username=i[0];j.userpwd=i[1];}return j;}function H(j,s){if(!s){s=P();}while(r=/@\[(.+?)\]/ig.exec(j)){var i=r[1];if(!(i&&(i=s[i.toLowerCase()]))){i="";}j=j.replace(r[0],i);}return j;}function e(j){var s=g(j);for(var i in j){if(j.hasOwnProperty(i)&&/(_url|_value)$/i.test(i)){j[i]=H(j[i],s);}}}function A(i){if(B(i)){return{openType:i.default_open_type,desktopShow:i.show_desktop_isValid==="true",desktopIcon:i.show_desktop_icon_url||i.default_icon_url,startmenuShow:i.show_startmenu_isValid==="true",startmenuIcon:"/themes/icon/"+(i.show_startmenu_icon_url||i.default_icon_url),fastlinkShow:i.show_fastlink_isValid==="true",fastlinkIcon:"/themes/icon/"+(i.show_fastlink_icon_url||i.default_icon_url),faceAppUrl:i.face_app_isValid==="true"?i.face_app_url:"",faceAppIsUpdate:i.face_app_isUpdate==="true",faceAppUpdateTimer:i.face_app_update_timer*1000||60000};}return{};}function h(i){if(B(i)){e(i);i.id=i.sys_app_id;i.title=i.default_title;i.path=i.default_url;i.deskIcon=i.show_desktop_icon_url||i.default_icon_url;i.icon=i.show_startmenu_icon_url||i.default_icon_url;i.url=i.default_url;i.isIframe=X(i.default_url);}return i;}for(var m=0;m<c.length;m++){var q=h(c[m]);var a=q.id;var W=q.title;var Z=q.icon;var D=q.path;var I=q.parent;var V=q.menuStyle;var K=q.deskIcon;var p=q.isIframe;var Y=[];var o=[];var M=false;if(q.submenu){var L=q.submenu;var G=L.length;if(G>0){M=true;}for(var l=0;l<G;l++){var d=L[l];var Q=d.id;var J=d.title;var S=d.icon;var k=d.path;var C=d.parent;var V=d.menuStyle;var T=d.deskIcon;var b=d.isIframe;var F=O(d);S="/themes/icon/"+S;var R=Ext.apply({text:J,icon:S,menuStyle:V,url:k,handler:null,scope:null,deskIcon:T,isIFrame:b,windowId:"module_"+Q},F);Y.push(R);var U=new WorkBench.menuModule({moduleId:"module_"+Q,moduleType:"SubApplication"});U.initLancher(Ext.apply({text:J,icon:S,url:k,type:"module",deskIcon:T,isIFrame:b,windowId:"module_"+Q},F));o.push(U);WorkBench.modules.push(U);}}Z="/themes/icon/"+Z;if(M){var U=new WorkBench.LauncherModule({moduleId:"module_"+a,moduleType:"Application"});U.initLancher({text:W,menuStyle:V,icon:Z,handler:function(){return false;},menu:Y,subModules:o});WorkBench.modules.push(U);}else{var U=new WorkBench.menuModule({moduleId:"module_"+a,moduleType:"Application"});U.initLancher(Ext.apply({text:W,icon:Z,menuStyle:V,url:D,deskIcon:K,isIFrame:p,windowId:"module_"+a},O(q),A(q)));WorkBench.modules.push(U);}}WorkBench.Desk=new Ext.app.App({init:function(){Ext.form.Field.prototype.msgTarget="side";Ext.BLANK_IMAGE_URL="resources/images/default/s.gif";Ext.QuickTips.init();},getModules:function(){var i=new etc.configure.PersonalSet();i.app=this;i.init();WorkBench.modules.push(i);return WorkBench.modules;},getStartConfig:function(){return{iconCls:"user",title:get_cookie("memberName"),toolPanelWidth:110,height:WorkBench.menuHeight};},getStartItemsConfig:function(){var t=[{disabled:true,disabledClass:"icon-user-item-disabled",iconCls:"icon-user",text:get_cookie("real_name")}];var i=new etc.configure.PersonalSet();i.app=this;i.init();t.push(i.launcher);var j=WorkBench.modules;if(j){var u={menu:{items:[]}};var s=u.menu.items;s.push({text:"startmenu",menu:{items:[]}});return{items:s[0].menu.items,toolItems:t};}return null;},getDesktopConfig:function(){Ext.Ajax.request({success:function(j){var i=Ext.decode(j.responseText);if(i.success){Ext.copyTo(WorkBench,i,"locale,timezone,currency,unitSystem,dateLong,dateShort,timeShort,timeLong,dateTimeLong,dateTimeShort");Ext.i18n.loadUserConfig(i);WorkBench.title=i.config.styles.title;WorkBench.authType=i.config.styles.authType;if(WorkBench.title!=""){window.document.title=WorkBench.title.loc();}this.initDesktopConfig(i.config);}},scope:this,url:"system/DesktopConfig.jcp"});},getLogoutConfig:function(){return{text:"注销".loc(),iconCls:"logout",handler:function(){Ext.Msg.confirm("注销".loc(),"您确认从系统中注销?".loc(),function(i){if(i=="yes"){window.legalQuit=true;top.location.replace("/login/logout.jcp");}},this);},scope:this};}});delete (WorkBench.con);delete (WorkBench.connectionConfig);},this);WorkBench.menuModule=Ext.extend(Ext.app.Module,{moduleType:null,moduleId:null,initLancher:function(item){var params={};this.launcher={handler:function(){this.desktop=WorkBench.Desk.desktop;if(this.openType==="false"){window.open(this.url);}else{if(this.isIFrame=="true"){var bsNode=new WorkBench.baseNode();bsNode.init(this);}else{var lib=this.url;if(lib==""){Ext.MessageBox.show({title:"提示",icon:Ext.MessageBox.INFO,msg:"系统建设中，敬请期待......",buttons:Ext.MessageBox.OK,closable:false});}else{var paramArray=this.url.split("?");lib=paramArray[0];var param=(paramArray.length>1)?Ext.urlDecode(paramArray[1]):{};param.objectId=param.parent_id;Ext.apply(this,param);using(lib);var processModule=null;processModule=eval("new "+lib+"()");processModule.init(this,param);}}}}};Ext.apply(this.launcher,item);}});WorkBench.LauncherModule=Ext.extend(Ext.app.Module,{moduleType:null,moduleId:null,initLancher:function(menuItem){var subMenuList=menuItem.menu;var newSubMenuArr=[];for(var i=0;i<subMenuList.length;i++){var subMenuObj=subMenuList[i];subMenuObj.handler=function(){this.desktop=WorkBench.Desk.desktop;if(this.isIFrame=="true"){var bsNode=new WorkBench.baseNode();bsNode.init(this);}else{var lib=this.url;if(lib==""){Ext.msg("error","系统定义导航,但没有加载任何程序,不能显示!".loc());}else{var paramArray=this.url.split("?");lib=paramArray[0];var param=(paramArray.length>1)?Ext.urlDecode(paramArray[1]):{};param.objectId=param.parent_id;Ext.apply(this,param);using(lib);var processModule=null;processModule=eval("new "+lib+"()");processModule.init(this);}}};subMenuObj.scope=subMenuObj;newSubMenuArr.push(subMenuObj);}this.launcher={text:menuItem.text,icon:menuItem.icon,url:menuItem.url,type:menuItem.type,subModules:menuItem.subModules,handler:menuItem.handler,scope:this,menu:{items:newSubMenuArr}};}});