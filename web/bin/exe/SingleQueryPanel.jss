Ext.namespace("bin.exe");bin.exe.SingleQueryPanel=function(parentPanel,params){var id=Ext.id();var grid=this.grid=new Ext.grid.PropertyGrid({id:id,onCellDblClick:function(g,row,col){},autoHeight:true});

this.MainTabPanel=new Ext.Panel({border:false,items:grid,tbar:[]});if(!params["objectId"]){if(params["showTopToolbar"]){var   tb=this.MainTabPanel.getTopToolbar();tb.push(new Ext.Toolbar.Button({btnId:"excel",gid:id,text:'导出EXCEL文件'.loc(),icon:"/themes/icon/xp/excel.gif",cls:"x-btn-text-icon  bmenu",disabled:false,scope:this,hidden:false,handler:this.onButtonClick}));tb.push(new Ext.Toolbar.Separator());tb.doLayout();}}else{var tb=this.MainTabPanel.getTopToolbar();var conn=new Ext.data.Connection();params["type"]="getButton";conn.request({method:"POST",url:"/bin/exe/singlequery.jcp",params:params});conn.on("requestcomplete",function(conn,oResponse){var singleJSON=Ext.decode(oResponse.responseText);var btns=singleJSON.buttonArray;for(var i=0;i<btns.length;i++){var btn=parentPanel.getButton(btns[i],this.MainTabPanel.id);btn.style="margin-right:10px;";tb.addButton(new Ext.Toolbar.Button(btn));}},this);}grid.on("render",function(){grid.loadData(params);},this);grid.loadData=function(cparams){var conn=new Ext.data.Connection();conn.request({method:"POST",url:"/bin/exe/singlequery.jcp",params:cparams});conn.on("requestcomplete",function(conn,oResponse){var singleJSON=Ext.decode(oResponse.responseText);this.grid.setSource(singleJSON);},this);}.createDelegate(this);};Ext.extend(bin.exe.SingleQueryPanel,Ext.Panel,{init:function(params){},onButtonClick:function(item){if(item.btnId=="excel"){var grid=Ext.getCmp(item.gid);var paramString="";for(var i in grid.store.baseParams){paramString+="&"+i+"="+grid.store.baseParams[i];}window.open(encodeURI("/bin/bi/singlequery.jcp?"+paramString.substring(1)),"_blank","height=10, width=10, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=no, status=no");}}});