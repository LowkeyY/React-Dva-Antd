WorkBench.baseNode=function(){this.frames=new Ext.ux.FrameParams();};WorkBench.baseNode.prototype={createMenu:function(M,C){var D=[];for(var E=0;E<C.length;E++){var H=C[E];var J=H.id;var F=H.title;var G=H.path;var N=H.object_id;var I=H.icon;var L=H.isIframe;Ext.useShims=true;var K=H.submenu;var A=null;if(E!=0){D.push(new Ext.Toolbar.Spacer());D.push(new Ext.Toolbar.Spacer());D.push(new Ext.Toolbar.Spacer());D.push(new Ext.Toolbar.Spacer());}if(H.submenu){A=this.getSubMenu(K,this.menuConfig.windowId);D.push(new Ext.Toolbar.Button(Ext.apply({id:J,text:F,cls:"x-btn-text  bmenu",disabled:false,hidden:false,scope:this,app_name:G,menu:A},I&&I.match(/^\/48all\//)?{iconUrl:I,template:new Ext.Template('<table id="{4}" cellspacing="0" class="x-btn {3}"><tbody class="{1}">','<tr><td class="x-btn-tl"><i>&#160;</i></td><td class="x-btn-tc"></td><td class="x-btn-tr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-ml"><i>&#160;</i></td><td class="x-btn-mc"><img src={5}><em class="{2}" unselectable="on"><button type="{0}"></button></em></td><td class="x-btn-mr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-bl"><i>&#160;</i></td><td class="x-btn-bc"></td><td class="x-btn-br"><i>&#160;</i></td></tr>',"</tbody></table>"),getTemplateA:Ext.Button.prototype.getTemplateArgs,getTemplateArgs:function(){return this.getTemplateA().concat("/themes/icon/"+this.iconUrl);}}:{})));}else{if(H.path=="bin.exe.Frame"&&N){D.push(new Ext.Toolbar.Button({id:J,text:F,cls:"x-btn-text  bmenu",disabled:false,hidden:false,scope:this,parent_id:N,isIFrame:L,app_name:G,handler:function(P){if(P.menu){return false;}if(P.handling){return false;}P.handling=true;var Q=function(){P.handling=false;};setTimeout(Q,2000);var O=this.mainPanel;CPM.get({method:"GET",url:"/bin/exe/getFrame.jcp?parent_id="+P.parent_id,success:function(R,S){var T=Ext.decode(R.responseText);var V=O.getComponent(0);if(typeof (V!=undefined)){try{O.remove(V);}catch(U){}}O.add(new Ext.Panel({layout:"border",border:false,items:CPM.Frame.getFrame(T)}));O.doLayout();}},true);}}));}else{D.push(new Ext.Toolbar.Button({id:J,text:F,cls:"x-btn-text  bmenu",disabled:false,hidden:false,scope:this,parent_id:N,isIFrame:L,app_name:G,handler:this.menuClick}));}}}var B={items:this.getMainPanel()};if(D.length>0){B[(M=="bottom")?"bbar":"tbar"]=D;}this.createWindow(this.menuConfig,B);},getTree:function(A){for(var B=0;B<A.length;B++){if(A[B].icon){A[B].icon="/themes/icon/"+A[B].icon;}A[B].text=A[B].title;if(A[B].submenu){A[B].expanded=true;A[B].children=this.getTree(A[B].submenu);}else{A[B].leaf=true;}}return A;},treeClick:function(B){if(!B.leaf||B.attributes.object_id==0){return false;}var A=this.mainPanel;CPM.get({method:"GET",url:"/bin/exe/getFrame.jcp?parent_id="+B.attributes.object_id,success:function(C,D){var E=Ext.decode(C.responseText);Ext.i18n.apply(E);var G=A.getComponent(0);if(typeof (G!=undefined)){try{A.remove(G);}catch(F){}}A.add(new Ext.Panel({layout:"border",border:false,items:CPM.Frame.getFrame(E)}));A.doLayout();}},true);},createSideBar:function(B,D){Ext.each(D,function(E){E.icon="/themes/icon/"+E.icon;if(E.submenu){E.bodyStyle="padding:5 0 0 5;overflow:auto;";E.items=new Ext.tree.TreePanel({autoScroll:true,animate:true,containerScroll:true,border:false,rootVisible:false,height:"300",root:{nodeType:"async",draggable:false,expanded:true,children:this.getTree(E.submenu)}});E.items.on("click",this.treeClick,this);}else{}E.listeners={expand:function(){function F(H){if(H.leaf){return H;}else{if(H.firstChild){return F(H.firstChild);}}}var G=this.items.length==0?(this.initialConfig.object_id?{leaf:true,attributes:{object_id:this.initialConfig.object_id}}:false):F(this.items.get(0).root.firstChild);if(G){this.items.length>0&&G.select();this.ownerCt.clickMenuAction(G);}}};},this);var A={layout:"accordion",border:false,split:true,defaults:{},getMenuNode:function(F){var E;this.items.each(function(H){if(H.items){var G=H.items.get(0).getNodeById(F);if(G){G.panelId=H.id;E=G;return false;}}},this);return E;},selectMenu:function(G){var F=this.getMenuNode(G);if(F){var E=Ext.getCmp(F.panelId);if(E&&E.collapsed){E.expand();}F.ensureVisible();F.select();}return F;},clickMenuAction:this.treeClick.createDelegate(this),clickMenu:function(F){var E=this.selectMenu(F);if(E){this.clickMenuAction(E);}},layoutConfig:{titleCollapse:true,hideCollapseTool:true,animate:true,activeOnTop:true},items:D,region:(B=="left")?"west":"east",width:180};var C=this.getMainPanel();C.region="center";this.createWindow(this.menuConfig,{layout:"border",items:[A,C]});},init:function(E){this.menuConfig=E;try{if(E.menuStyle=="none"){this.createWindow(E,{items:this.getMainPanel()});}else{var C=new Ext.data.Connection();var A=E.windowId;var D=A.split("_");C.on("requestcomplete",function(F,H){var I=Ext.decode(H.responseText);if(I.menu.length>0){var G=this.menuConfig.menuStyle;this[(G=="left"||G=="right")?"createSideBar":"createMenu"](G,I.menu);}else{this.createWindow(this.menuConfig,{items:this.getMainPanel()});}},this);C.request({method:"GET",url:"/home/system/getmenu.jcp?id="+D[1]+"&ra="+Math.random()});}}catch(B){Ext.msg("error",B);}},getMainPanel:function(){var B=this.menuConfig;var A;if(B.isIFrame=="true"){A=new Ext.ux.IFrameComponent({id:B.windowId,url:B.url});}else{A=this.main(B);}!this.mainPanel&&(this.mainPanel=A);return A;},menuClick:Ext.emptyFn,createWindow:function(H,B){var G=H.desktop.getWindow(H.windowId);if(!G){var F=H.desktop.getViewWidth();var A=H.desktop.getViewHeight();function E(J,I){if(J==0){return I;}return J<1?I*J:J;}function D(K,I,J){if(K==-1){return(I-J)/2;}if(K<0){K*=-1;}if(K<1&&K>0){return I*K;}return K;}H.winWidth=E(+H.winWidth,F);H.winHeight=E(+H.winHeight,A);Ext.isMultiScreen&&(H.winWidth/=2);var C=Ext.apply({id:H.windowId,title:H.text||H.tooltip,layout:"fit",icon:H.icon||H.windowIcon,shim:true,animCollapse:false,constrainHeader:true,minimizable:H.winResizable===true,maximizable:H.winResizable===true,draggable:H.winDraggable===true,width:H.winWidth,height:H.winHeight,x:D(+H.x,F,H.winWidth),y:D(+H.y,A,H.winHeight)},B);G=H.desktop.createWindow(C);this.frames.bindWin(G);G.once("afterlayout",function(){this.doWinLayout(G);},this);}G.show();},getSubMenu:function(K,M){var E=new Ext.menu.Menu();if(K){var C=K.length;for(var F=0;F<C;F++){var D=K[F];var J=D.id;var G=D.title;var H=D.path;var N=D.object_id;var I=D.icon;var L=D.isIFrame;var O=D.submenu;var B=null;if(O){B=this.getSubMenu(O,M);}var A=null;if(I!=""){A="/themes/icon/"+I;}var D=new Ext.menu.Item({id:J,text:G,cls:"bmenu",parent_id:N,disabled:false,icon:A,hidden:false,windowsId:M,scope:this,isIFrame:L,menu:B,hideOnClick:(B==null),handler:function(Q){if(Q.menu){return false;}var P=this.mainPanel;CPM.get({method:"GET",url:"/bin/exe/getFrame.jcp?parent_id="+Q.parent_id,success:function(R,S){var T=Ext.decode(R.responseText);Ext.i18n.apply(T);var V=P.getComponent(0);if(typeof (V!=undefined)){try{P.remove(V);}catch(U){}}P.add(new Ext.Panel({layout:"border",border:false,items:CPM.Frame.getFrame(T)}));P.doLayout();}},true);}});E.addItem(D);}}return E;},main:function(){return{};},doWinLayout:function(A){return{};}};Ext.ux.FrameParams=function(){this.params={};this.win=null;this.bindWin=function(A){this.win=A;A.on("destroy",function(){delete (this.params);delete (this.win);},this);};};Ext.ux.FrameParams.prototype={createPanel:function(A,B){if(typeof (A)=="object"){B=A;A=B.id||B.name;}else{if(typeof (B)!="undefined"){if(typeof (B)=="function"){B=new B();}}else{throw"参数传递错误".loc();}}this.set(A,B);B.frames=this;return B;},set:function(A,B){this.params[A]=B;},get:function(A){return this.params[A];},remove:function(A){delete (this.params[A]);},containsKey:function(A){return typeof (this.params[A])!="undefined";}};