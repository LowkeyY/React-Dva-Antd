Ext.ns("ExternalItems.haiwaizhishigongxiang");using("ExternalItems.haiwaizhishigongxiang.PluginUitls");ExternalItems.haiwaizhishigongxiang.downLoadFile=function(btn,type){var gridPanel=Ext.getCmp(btn.panelId);var fileId;var rec;if(type=="rec"){rec=gridPanel.getSelectionModel().getSelections();if(rec.length==0){Ext.msg("warn","请选择行.");return ;}rec=rec[0];fileId=rec.get("pmk").split("::")[0];}else{if(type=="input"){fileId=gridPanel.param.dataId;}else{fileId=gridPanel.param.fileExportData;}}Ext.Ajax.request({url:"/ExternalItems/haiwaizhishigongxiang/PanelGridBeforeInit.jcp",params:{file_id:fileId},method:"post",scope:this,success:function(response,options){var result=Ext.decode(response.responseText);if(result.success){var path=result.previewPath||"";var isLocal=result.isLocal||false;switch(result.showType){case 0:CPM.openModuleWindow("2b681a3f-9d25-48a8-aea0-f62fb9d1942a",gridPanel,{pageType:"new"},{title:"申请使用",width:650,height:300,file_name:rec.get("FILE_INFO_NAME"),file_id:rec.get("pmk")});break;case 1:case 2:var form=document.createElement("form");form.target="InnerFileDownloadFrame";form.method="POST";form.id=Ext.id();form.action="/ExternalItems/haiwaizhishigongxiang/downFile.jcp";hd=document.createElement("input");hd.type="hidden";hd.name="fileId";hd.value=rec.get("pmk");form.appendChild(hd);document.body.appendChild(form);form.submit({success:function(f,a){Ext.Msg.alert("Success","It worked");},failure:function(f,a){Ext.Msg.alert("Warning",a.result.errormsg);}});setTimeout(function(){Ext.removeNode(form);},300);break;case 3:Ext.msg("infos","使用申请已发送，<br>请耐心等待审批通知。");break;case 4:Ext.msg("confirm","您上次申请使用的文档 <br>-- 《"+rec.get("FILE_INFO_NAME")+"》，<br>未获批准，是否再次申请使用?",function(answer){if(answer=="yes"){CPM.openModuleWindow("148875",gridPanel,{pageType:"new"},{title:"申请使用",width:650,height:300,file_name:rec.get("FILE_INFO_NAME"),file_id:rec.get("pmk")});}});break;}}}});};