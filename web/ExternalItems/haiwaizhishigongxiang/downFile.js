Ext.namespace("ExternalItems.haiwaizhishigongxiang");ExternalItems.haiwaizhishigongxiang.downFile=function(btn,type){var type=type;var fileId;var file_upload;var panel=Ext.getCmp(btn.panelId);if(type=="rec"){var rec=panel.getSelectionModel().getSelections();if(rec.length==0){Ext.msg("warn","请选择要下载的行.");return ;}fileId=rec[0].get("pmk").split("::")[0];file_upload=rec[0].get("FILE_UPLOADER").value;}else{if(type=="input"){fileId=panel.param.dataId;}else{fileId=panel.param.fileExportData;}}var userid=get_cookie("user_id");var form=document.createElement("form");form.target="_blank";form.method="POST";form.id=Ext.id();form.action="/ExternalItems/haiwaizhishigongxiang/downFile.jcp";var hiddens,hd,hd2;hiddens=[];hd=document.createElement("input");hd.type="hidden";hd.name="fileId";hd.value=fileId;hd2=document.createElement("input");hd2.type="hidden";hd2.name="userid";hd2.value=userid;hd3=document.createElement("input");hd3.type="hidden";hd3.name="file_upload";hd3.value=file_upload;form.appendChild(hd);form.appendChild(hd2);form.appendChild(hd3);hiddens.push(hd);hiddens.push(hd2);hiddens.push(hd3);document.body.appendChild(form);form.submit({success:function(f,a){Ext.Msg.alert("Success","It worked");},failure:function(f,a){Ext.Msg.alert("Warning",a.result.errormsg);}});setTimeout(function(){Ext.removeNode(form);},100);};